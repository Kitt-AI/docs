

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extended Example: A Conversational Yelp Bot &mdash; ChatFlow 0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" type="text/css" />
  

  
    <link rel="top" title="ChatFlow 0.1 documentation" href="index.html"/>
        <link rel="next" title="Telegram Bot Tutorials" href="telegram.html"/>
        <link rel="prev" title="Debug ChatFlow" href="debug.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            
              <a href="http://chatflow.kitt.ai" target="_blank" class="icon icon-home"> ChatFlow
            
          

          
            
            <img src="_static/chatflow-logo.png" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Welcome to ChatFlow</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">ChatFlow Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_a_bot.html">ChatFlow Build A Bot Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogue_nodes.html">Dialogue Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">Debug ChatFlow</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Extended Example: A Conversational Yelp Bot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extended-example-walkthrough-video">Extended Example Walkthrough Video</a></li>
<li class="toctree-l2"><a class="reference internal" href="#starting-your-conversational-project">Starting your conversational project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-a-project">1. Create a Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-an-nlu-project">2. Create an NLU project</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-nlu">3. Configuring NLU</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-your-flow">Creating your flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initialization">1. Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#understanding-the-user-s-request">2. Understanding the User&#8217;s Request</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#information-cases">Information Cases</a></li>
<li class="toctree-l4"><a class="reference internal" href="#collect-missing-information">Collect Missing Information</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#fulfilling-the-user-s-request-through-a-yelp-query">3. Fulfilling the User&#8217;s Request through a Yelp Query</a></li>
<li class="toctree-l3"><a class="reference internal" href="#presenting-yelp-results-to-the-user">4. Presenting Yelp Results to the User</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-a-choice-from-the-user">5. Getting a Choice from the User</a></li>
<li class="toctree-l3"><a class="reference internal" href="#answering-user-questions-about-the-choices-presented">6. Answering user questions about the choices presented</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#final-thoughts">Final Thoughts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="telegram.html">Telegram Bot Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="facebook.html">Facebook Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="slack.html">Slack Bot Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="twilio.html">Twilio Bot Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="kik.html">Kik Bot Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="skype.html">Skype Bot Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="alexa.html">Alexa Skill Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="alexa_advanced.html">Advanced Alexa Skill Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="alexa_nlu.html">Advanced Alexa Skill NLU Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth2.html">OAuth2/Uber Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ChatFlow</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Extended Example: A Conversational Yelp Bot</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          <a href="https://groups.google.com/a/kitt.ai/forum/#!forum/chat" class="fa fa-comments" style="color:#55507c" target="_blank"> Forum</a>
        
        
            
            <a href="_sources/extended_example.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="extended-example-a-conversational-yelp-bot">
<span id="extended-example"></span><h1><a class="toc-backref" href="#id3">Extended Example: A Conversational Yelp Bot</a><a class="headerlink" href="#extended-example-a-conversational-yelp-bot" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#extended-example-a-conversational-yelp-bot" id="id3">Extended Example: A Conversational Yelp Bot</a><ul>
<li><a class="reference internal" href="#introduction" id="id4">Introduction</a></li>
<li><a class="reference internal" href="#extended-example-walkthrough-video" id="id5">Extended Example Walkthrough Video</a></li>
<li><a class="reference internal" href="#starting-your-conversational-project" id="id6">Starting your conversational project</a><ul>
<li><a class="reference internal" href="#create-a-project" id="id7">1. Create a Project</a></li>
<li><a class="reference internal" href="#create-an-nlu-project" id="id8">2. Create an NLU project</a></li>
<li><a class="reference internal" href="#configuring-nlu" id="id9">3. Configuring NLU</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-your-flow" id="id10">Creating your flow</a><ul>
<li><a class="reference internal" href="#initialization" id="id11">1. Initialization</a></li>
<li><a class="reference internal" href="#understanding-the-user-s-request" id="id12">2. Understanding the User&#8217;s Request</a><ul>
<li><a class="reference internal" href="#information-cases" id="id13">Information Cases</a></li>
<li><a class="reference internal" href="#collect-missing-information" id="id14">Collect Missing Information</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fulfilling-the-user-s-request-through-a-yelp-query" id="id15">3. Fulfilling the User&#8217;s Request through a Yelp Query</a></li>
<li><a class="reference internal" href="#presenting-yelp-results-to-the-user" id="id16">4. Presenting Yelp Results to the User</a></li>
<li><a class="reference internal" href="#getting-a-choice-from-the-user" id="id17">5. Getting a Choice from the User</a></li>
<li><a class="reference internal" href="#answering-user-questions-about-the-choices-presented" id="id18">6. Answering user questions about the choices presented</a></li>
</ul>
</li>
<li><a class="reference internal" href="#final-thoughts" id="id19">Final Thoughts</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id4">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial, we create a conversational bot that interacts with Yelp API.</p>
<p>Here is an example of the bot in action:</p>
<video width="640"  controls>
  <source src="_static/img/extendedexample/ExtendedExampleDemo.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
<br> <br> <br><p>This tutorial walks you through a more advanced bot. The goal of this tutorial
is to provide you with a better understand of building more complex and robust
bots. In addition, this tutorial will showcase how to configure and integrate a
API node into your bot seamlessly.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This project is available in the sample projects section in the create
new app dialogue.</p>
</div>
</div>
<div class="section" id="extended-example-walkthrough-video">
<span id="id1"></span><h2><a class="toc-backref" href="#id5">Extended Example Walkthrough Video</a><a class="headerlink" href="#extended-example-walkthrough-video" title="Permalink to this headline">¶</a></h2>
<p>Here is a video walking you through the entire Yelp Bot creation process:</p>
<iframe width="640" height="360" src="https://www.youtube.com/embed/XdHMGkgyNZQ"
   frameborder="0" allowfullscreen></iframe>
<br><br><br></div>
<div class="section" id="starting-your-conversational-project">
<h2><a class="toc-backref" href="#id6">Starting your conversational project</a><a class="headerlink" href="#starting-your-conversational-project" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create-a-project">
<h3><a class="toc-backref" href="#id7">1. Create a Project</a><a class="headerlink" href="#create-a-project" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Create a new app from scratch in <a class="reference external" href="https://chatflow.kitt.ai/">ChatFlow</a>.. Double click it in the app list to open the
ChatFlow editor.</li>
<li>Add a <strong>router</strong> node to the canvas.</li>
<li>Drag in a <strong>Chat In</strong> and <strong>Chat Out</strong>.</li>
</ol>
</div>
<div class="section" id="create-an-nlu-project">
<h3><a class="toc-backref" href="#id8">2. Create an NLU project</a><a class="headerlink" href="#create-an-nlu-project" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Go to <a class="reference external" href="https://nlu.kitt.ai/">NLU</a> and create a new project.</li>
<li>Add the following <em>intents</em>:</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="18%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><em>intents</em></th>
<th class="head">Description</th>
<th class="head">Sample Utterances</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">request_suggestion</span></code></td>
<td>Users asked bot for a suggestion</td>
<td>I&#8217;d like a Chinese restaurant in Seattle, I would like to go eat Mexican food in San Francisco, I want Nachos near the Univeristy of Washington</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">state_choice</span></code></td>
<td>Users state the choice</td>
<td>The first one, please., The second sounds delicious!, Definitely the third one.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">request_more_options</span></code></td>
<td>User ask for more business choices</td>
<td>Give me more options., Can you look up more options?, I don&#8217;t like any of the choices</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">request_rating</span></code></td>
<td>User requests for Yelp ratings</td>
<td>What&#8217;s the rating?, Are the reivew positive?, How good is the first one?</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">request_hours</span></code></td>
<td>User requests for hours of operation</td>
<td>what are the hours?, is the first one open now?, how long is two open for?</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">request_address</span></code></td>
<td>User requests for business location</td>
<td>what&#8217;s the address?,  how far is the first one?, where is number 2?</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">info_request</span></code></td>
<td>User asks for more information</td>
<td>what about 2, tell me about option three, what can you tell me about the first one</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">agree</span></code></td>
<td>User likes a choice</td>
<td>hello, good morning, how&#8217;s it going?</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">reject</span></code></td>
<td>User does not like any choices</td>
<td>Yes, Yeah, Sure</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">opening</span></code></td>
<td>User greets the bot</td>
<td>No, Nope, None</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">thanking</span></code></td>
<td>User thanks the bot</td>
<td>thanks, thank you, much appreciated</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">closing</span></code></td>
<td>User ends the conversation</td>
<td>Goodbye, See ya!, Good night</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li>Next, click on &#8220;set-up entities&#8221; and add the following <em>entities</em>:</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="41%" />
<col width="39%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><em>entities</em></th>
<th class="head">Description</th>
<th class="head">Phrases</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">businesstype</span></code></td>
<td>Type of Restaurant</td>
<td>Tacos, Coffee, Chinese Restaurant</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">location</span></code></td>
<td>Location of Search</td>
<td>Seattle, Tokyo, U-district</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">enum_choice</span></code></td>
<td>Number Associated with Users Choice</td>
<td>First, 2, Three</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Feel free to add any more <em>intents</em> and <em>entities</em> you may need.</p>
</div>
<ol class="arabic simple" start="4">
<li>Once you are finished adding your <em>intents</em> and <em>entities</em>, click deploy and
return to your NLU app list.</li>
<li>Click on the deployment information and copy the Deployment URL.</li>
</ol>
<p>You can download the <a class="reference download internal" href="_downloads/yelp_nlu.json" download=""><code class="xref download docutils literal"><span class="pre">example</span> <span class="pre">Yelp</span> <span class="pre">NLU</span> <span class="pre">app</span></code></a> and
import to <a class="reference external" href="https://nlu.kitt.ai/">NLU</a> using the import JSON feature.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For more information on creating effective NLU models using the intent
and entity paradigm, see <a class="reference external" href="http://docs.kitt.ai/nlu">NLU documentation</a>.</p>
</div>
</div>
<div class="section" id="configuring-nlu">
<h3><a class="toc-backref" href="#id9">3. Configuring NLU</a><a class="headerlink" href="#configuring-nlu" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Back in Chatflow, drag in an NLU node.</li>
<li>Connect the Chat In, NLU, Router, and Chat Out Nodes together like below:</li>
</ol>
<img alt="_images/Initial-Flow.png" class="align-center" src="_images/Initial-Flow.png" />
<ol class="arabic" start="3">
<li><p class="first">Double click in NLU node. Paste the Deployment URL into the URL field.  Don&#8217;t forget
to add <code class="docutils literal"><span class="pre">{{{payload}}}</span></code> to the end of the URL. The final URL will look like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>http://api-nlu.kitt.ai/v1/api/900584f4-7360-479c?token=xxx?q={{{payload}}}
</pre></div>
</div>
<img alt="_images/NLU-node-payload.png" class="align-center" src="_images/NLU-node-payload.png" />
</li>
</ol>
</div>
</div>
<div class="section" id="creating-your-flow">
<h2><a class="toc-backref" href="#id10">Creating your flow</a><a class="headerlink" href="#creating-your-flow" title="Permalink to this headline">¶</a></h2>
<div class="section" id="initialization">
<h3><a class="toc-backref" href="#id11">1. Initialization</a><a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Start by adding an <strong>enter</strong> node and a <strong>state</strong> node.</li>
<li>Set up the enter node by removing the default entrance condition, and check
the box that says <em>Enter Initial state</em>.</li>
<li>Edit the state node. Name it <em>Initialized state</em></li>
<li>Add the following code into the body of the state node:</li>
</ol>
<blockquote>
<div><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">address</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">businesstype</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">req_pending</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">user_choice</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="k">return</span> <span class="nx">msg</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">location</span></code> variable keeps the location where Yelp will look for
restaurants. The <code class="docutils literal"><span class="pre">businesstype</span></code> variable is the kind of restaurant the agent
will look for. The <code class="docutils literal"><span class="pre">req_pending</span></code> variable is <code class="docutils literal"><span class="pre">true</span></code> if we have all the
information we need for a Yelp query, but have not yet issued the query. The
<code class="docutils literal"><span class="pre">user_choice</span></code> variable keeps track of which restaurant the user has chosen.</p>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">This initialization enter-state node flow is a great place to create user
defined variables that will appear throughout the entire app!</p>
</div>
<ol class="arabic simple" start="5">
<li>In the <em>Output text</em> box, write a welcome message:</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><em>Welcome! I can find restaurants for you in Yelp! What can I help you with?</em></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="6">
<li>Check the <em>request User Input after this node</em> option.</li>
<li>Connect the enter node and the state node.</li>
<li>Next add another <strong>enter</strong> node, name it <em>intent: hello</em>, and set it&#8217;s entrnace
condition to:</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.NLU.intent</span> <span class="pre">==</span> <span class="pre">opening</span></code></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="9">
<li>Finally, connect the <em>intent: hello</em> enter node to the <em>Initialized state</em>
state node.</li>
</ol>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">It is a good idea to have your bot return to its initial state
whenever a user says <em>hello</em>.</p>
</div>
<p>Your flow should now look like the following figure:</p>
<img alt="_images/Flow-2.png" class="align-center" src="_images/Flow-2.png" />
</div>
<div class="section" id="understanding-the-user-s-request">
<h3><a class="toc-backref" href="#id12">2. Understanding the User&#8217;s Request</a><a class="headerlink" href="#understanding-the-user-s-request" title="Permalink to this headline">¶</a></h3>
<p>Next, let&#8217;s create the parts of the conversational flow that allow the agent to
collect information from the user.</p>
<ol class="arabic simple">
<li>Add another enter node. Name it <em>entity: businesstype</em>, Create a
<em>direct link</em> from the state node <em>Initialized State</em>.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To create a <em>direct link</em>, connect the output of the state node
to the input of enter node. The connection will be marked by a dash line.</p>
</div>
<ol class="arabic simple" start="2">
<li>Edit the entrance condition to be <code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.NLU.entities.businesstype</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">null</span></code>.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">NLU.entities is a dictionary with the entity types present in the
utterance set as the keys and the correspond part of the utterance set as the
values. If an entity is not present in an utterance, it will not appear in the
NLU.entities dictionary.</p>
</div>
<ol class="arabic simple" start="3">
<li>Add one more enter node. Name it <em>entity: location</em>, edit the entrance
condition to be <code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.NLU.entities.location</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">null</span></code>.</li>
<li>Create a <em>direct link</em> from the state node <em>Initialized State</em>.</li>
<li>Next, add a state node to follow the recently created enter nodes. Call it
<em>Save business type and address</em>, and add the following code:</li>
</ol>
<blockquote>
<div><div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="s1">&#39;businesstype&#39;</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">NLU</span><span class="o">.</span><span class="n">entities</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">businesstype</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">NLU</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">businesstype</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="s1">&#39;location&#39;</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">NLU</span><span class="o">.</span><span class="n">entities</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">NLU</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">location</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">return</span> <span class="n">msg</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Your flow should now look like the following figure:</p>
<img alt="_images/Flow-3.png" class="align-center" src="_images/Flow-3.png" />
<div class="section" id="information-cases">
<h4><a class="toc-backref" href="#id13">Information Cases</a><a class="headerlink" href="#information-cases" title="Permalink to this headline">¶</a></h4>
<p>Let&#8217;s now add four new enter nodes that handle the cases where the state node
above sets:</p>
<blockquote>
<div><ol class="arabic simple">
<li>both business type and location,</li>
<li>only business type</li>
<li>only location</li>
<li>neither business type nor location</li>
</ol>
</div></blockquote>
<ol class="arabic" start="6">
<li><p class="first">Drag in a new enter node, name it <em>Got Business Type and Address</em> and set the
entrance conditions to:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.kitt.businesstype</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">null</span></code></li>
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.kitt.address</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">null</span></code>.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Check the box that says <em>Enter only from direct link</em>.</p>
</li>
<li><p class="first">Additionally, create a <em>direct link</em> with the last state node added.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A <em>direct link</em> connection creates an <strong>ordering preference</strong>, which
ensures that, once pervious state node has been executed, any enter nodes
<em>linked</em> to it will be given priority by the router.</p>
</div>
<ol class="arabic simple" start="9">
<li>Add state node, connect it to the enter node, and input the following code
into the body of the function:</li>
</ol>
<blockquote>
<div><div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">req_pending</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
<span class="k">return</span> <span class="n">msg</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="10">
<li><p class="first">Add another enter node, name it <em>Got address but not business</em>, and set its
conditions to:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.kitt.businesstype</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">null</span></code></li>
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.kitt.address</span> <span class="pre">is</span> <span class="pre">null</span></code></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Check <em>Enter only from direct link</em> and create a <em>direct link</em> with the
<em>Save business type and address</em> state node.</p>
</li>
<li><p class="first">Add another state node and connect it to enter node and add the following
output text:</p>
<blockquote>
<div><ul class="simple">
<li><em>Ok, I got {{kitt.address}}, but I didn&#8217;t get the restaurant type</em></li>
</ul>
</div></blockquote>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To access user variables in output text, use <code class="docutils literal"><span class="pre">{{kitt.variable}}</span></code>
where variable is in place of the variable you wish to include.</p>
</div>
<ol class="arabic" start="13">
<li><p class="first">Add another enter node, name it <em>Got business but not address</em>, and set its
conditions to:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.kitt.address</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">null</span></code></li>
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.kitt.businesstype</span> <span class="pre">is</span> <span class="pre">null</span></code></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Check <em>Enter only from direct link</em> and create a <em>direct link</em> with the
<em>Save business type and address</em> state node.</p>
</li>
<li><p class="first">Add a new state node, connected to the enter nodes, and add the output text:</p>
<blockquote>
<div><ul class="simple">
<li><em>Ok, a place in {{kitt.businesstype}}, but I didn&#8217;t get the location</em></li>
</ul>
</div></blockquote>
</li>
</ol>
<p>Your flow should now look like the following figure:</p>
<img alt="_images/Flow-4.png" class="align-center" src="_images/Flow-4.png" />
</div>
<div class="section" id="collect-missing-information">
<h4><a class="toc-backref" href="#id14">Collect Missing Information</a><a class="headerlink" href="#collect-missing-information" title="Permalink to this headline">¶</a></h4>
<p>Now we have a network that allows the agent to welcome the user, prompt the user
to request a restaurant suggestion, determine whether the agent picked up a
location and restaurant type from the user&#8217;s request, and give the user feedback.</p>
<p>Now let&#8217;s see how we add additional nodes that take care of the situations
where we have either <code class="docutils literal"><span class="pre">businesstype</span></code> or <code class="docutils literal"><span class="pre">location</span></code>.</p>
<ol class="arabic" start="16">
<li><p class="first">Add an enter node, name it <em>state: no address</em>, and set the entrance
condition:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.kitt.address</span> <span class="pre">is</span> <span class="pre">null</span></code></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Add a new state node and connect to it a new enter node, name it
<em>ask for location</em>, and set the output text:</p>
<blockquote>
<div><ul class="simple">
<li><em>What&#8217;s the desired location?</em></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Create a direct link from the state node <em>ask for location</em> to the enter
node <em>entity: location</em>.</p>
</li>
<li><p class="first">Add another enter node, name it <em>state: no business type</em> and set the
entrance condition to:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.kitt.businesstype</span> <span class="pre">is</span> <span class="pre">null</span></code></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Add a new state node, name it <em>ask for business type</em>, and set the output
text to:</p>
<blockquote>
<div><ul class="simple">
<li><em>What kind of restaurant are you looking for?</em></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Finally, create a <em>direct link</em> from the state node <em>ask for business</em> to
the enter node <em>entity: businesstype</em>.</p>
</li>
</ol>
<p>Now the system is ready to accept user requests, and to clarify requests when
needed.</p>
<p>Your flow should now look like the following figure:</p>
<img alt="_images/Flow-5.png" class="align-center" src="_images/Flow-5.png" />
</div>
</div>
<div class="section" id="fulfilling-the-user-s-request-through-a-yelp-query">
<h3><a class="toc-backref" href="#id15">3. Fulfilling the User&#8217;s Request through a Yelp Query</a><a class="headerlink" href="#fulfilling-the-user-s-request-through-a-yelp-query" title="Permalink to this headline">¶</a></h3>
<p>Once we have the location and restaurant type, the agent is ready to get a list
of restaurant suggestions by issuing a query to Yelp through the Yelp API, which
is already conveniently packaged as a ChatFlow node.</p>
<ol class="arabic simple">
<li>Drag in a Yelp node and double click to edit.</li>
</ol>
<img alt="_images/yelp-node.png" class="align-center" src="_images/yelp-node.png" />
<ol class="arabic simple" start="2">
<li>In the node into put your <em>Consumer key</em>, a <em>Consumer secret</em>, a <em>Token</em> and
a <em>Token secret</em>.</li>
</ol>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You must provide these values to configure your Yelp node. You can
obtain these by signing up for the <a class="reference external" href="http://www.yelp.com/developers/v2">Yelp developer API</a>.</p>
</div>
<p>The Yelp node builds a query by using a term in <code class="docutils literal"><span class="pre">msg.yelp.term</span></code> and a location in
<code class="docutils literal"><span class="pre">msg.yelp.location</span></code>. <code class="docutils literal"><span class="pre">msg.yelp.limit</span></code> limits the number of candidates in the
output. The result of the Yelp query will be placed in the <code class="docutils literal"><span class="pre">msg.payload</span></code>.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">For more information about an API nodes input requirements and outputs,
check out the info tab!</p>
</div>
</div></blockquote>
<ol class="arabic" start="3">
<li><p class="first">Add a new enter node, name it <em>state: request ready</em>, set its
entrance conditions to the following:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.kitt.req_pending</span> <span class="pre">is</span> <span class="pre">true</span></code></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Connect to this enter node a new state node, name it <em>Yelp request</em>, and add
the following code:</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">prepare</span> <span class="n">yelp</span> <span class="n">search</span>
<span class="n">msg</span><span class="o">.</span><span class="n">yelp</span> <span class="o">=</span> <span class="p">{</span><span class="n">term</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">businesstype</span><span class="p">,</span>
            <span class="n">location</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">10</span><span class="p">};</span>

<span class="o">//</span> <span class="n">dont</span> <span class="n">request</span> <span class="n">the</span> <span class="n">same</span> <span class="n">search</span> <span class="n">again</span>
<span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">reqready</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>

<span class="k">return</span> <span class="n">msg</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">Connect this state node to the Yelp node.</p>
</li>
</ol>
<p>Your flow should now look like the following figure:</p>
<img alt="_images/Flow-6.png" class="align-center" src="_images/Flow-6.png" />
</div>
<div class="section" id="presenting-yelp-results-to-the-user">
<h3><a class="toc-backref" href="#id16">4. Presenting Yelp Results to the User</a><a class="headerlink" href="#presenting-yelp-results-to-the-user" title="Permalink to this headline">¶</a></h3>
<p>Now the bot can issue queries through the Yelp API. Next, we need to process the
output of the Yelp node (accessible as  <code class="docutils literal"><span class="pre">msg.payload</span></code>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For details on how the output is formatted, see the <a class="reference external" href="http://www.yelp.com/developers/v2">Yelp API documentation</a>.</p>
</div>
<p>Our query will produce ten results. Presenting all ten at once would be
disastrous in both speech-to-speech and chat scenarios. So let&#8217;s present three
choices at a time and give the user the option to hear further choices.</p>
<ol class="arabic simple">
<li>Add a new state node, name it <em>list choices</em>, add the following code to
process the Yelp API results:</li>
</ol>
<blockquote>
<div><div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">yelp_results</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">businesses</span><span class="p">;</span>
<span class="n">msg</span><span class="o">.</span><span class="n">payload</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

<span class="n">var</span> <span class="n">numresults</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">yelp_results</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">numresults</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">yelp_results</span><span class="o">.</span><span class="n">length</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">numresults</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;I found &#39;</span> <span class="o">+</span> <span class="n">numresults</span> <span class="o">+</span> <span class="s2">&quot; places that might work. &quot;</span><span class="p">];</span>

    <span class="k">if</span><span class="p">(</span><span class="n">numresults</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">numresults</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;The first 3 are:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="n">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">numresults</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;. &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">yelp_results</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">yelp_results</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">image_url</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">yelp_results</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">image_url</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;Do any of these sound okay?&quot;</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Oops I didn&#39;t find anything on Yelp. Please update the address and business type. &quot;</span><span class="p">];</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">businesstype</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">return</span> <span class="n">msg</span><span class="p">;</span>
</pre></div>
</div>
<p>First, we are saving the results in a user variable called <code class="docutils literal"><span class="pre">yelp_results</span></code>.
We can access this variable in other nodes as <code class="docutils literal"><span class="pre">msg.kitt.yelp_results</span></code>.</p>
<p>Then, we format the bot&#8217;s utterance directly in <code class="docutils literal"><span class="pre">msg.kitt._responses</span></code> by
using a loop to add the names of the restaurants to the bot&#8217;s utterance.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Output text</strong> field sets <code class="docutils literal"><span class="pre">msg.kitt._responses[0]</span></code> with the content
of the text field.</p>
</div>
<p>The bot will end with the question: <em>Do any of these sound okay?</em></p>
<p>From here, we need our bot to extract the user input (affirmative, negative, or a
request for more choices) and respond accordingly.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Add an enter node, name it <em>intent: Yes</em>, set the entrance condition to
<code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.NLU.intent</span> <span class="pre">==</span> <span class="pre">accept</span></code>.</li>
<li>Check <em>Enter only from direct link</em> and create a <strong>direct link</strong> from the
<em>list choices</em> state node.</li>
<li>Add a new state node, name it <em>request choice</em>, and set the Output text field:</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><em>Great! Which one?</em></li>
</ul>
</div></blockquote>
<ol class="arabic" start="5">
<li><p class="first">Check the <em>request User Input after this node</em> option.</p>
</li>
<li><p class="first">Next, add a new enter node called <em>intent: No</em> with the entrance condition
<code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.NLU.intent</span> <span class="pre">==</span> <span class="pre">reject</span></code>.</p>
</li>
<li><p class="first">Check <em>Enter only from direct link</em> and create a <strong>direct link</strong> with the
<em>list choices</em> enter node.</p>
</li>
<li><p class="first">Add another enter node, name it <em>intent: list more</em>, and add the following two
entrance conditions:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.NLU.intent</span> <span class="pre">==</span> <span class="pre">request_more_options</span></code></li>
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.kitt.yelp_results</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">null</span></code></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Add a new state node, name it <em>list more choices</em>, and add the following code:</p>
</li>
</ol>
<blockquote>
<div><div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span><span class="p">(</span><span class="n">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">yelp_results</span><span class="o">.</span><span class="n">shift</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">var</span> <span class="n">numresults</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">yelp_results</span><span class="o">.</span><span class="n">length</span><span class="p">;</span>

<span class="k">if</span><span class="p">(</span><span class="n">numresults</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Sorry, I&#39;m all out of options, but you can try a different search request.&quot;</span> <span class="p">];</span>
<span class="k">return</span> <span class="n">msg</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ok, I have &#39;</span> <span class="o">+</span> <span class="n">numresults</span> <span class="o">+</span> <span class="s2">&quot; more places. &quot;</span><span class="p">];</span>

<span class="k">if</span><span class="p">(</span><span class="n">numresults</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
<span class="n">numresults</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;The next 3 are:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">for</span><span class="p">(</span><span class="n">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">numresults</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;. &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">yelp_results</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">yelp_results</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">image_url</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">yelp_results</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">image_url</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;Do any of these sound okay?&quot;</span>

<span class="n">msg</span><span class="o">.</span><span class="n">NLU</span><span class="o">.</span><span class="n">intent</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
<span class="k">return</span> <span class="n">msg</span><span class="p">;</span>
</pre></div>
</div>
<p>This code will remove the restaurant options we already used, check if there are
still options available, and, if there still are options, present them to the user.</p>
</div></blockquote>
<ol class="arabic simple" start="10">
<li>Connect the <em>intent: list more</em> and <em>intent: No</em> enter nodes to the state node
called <em>list more choices</em>.</li>
<li>Create <strong>direct links</strong> from <em>list more choices</em> to each of the enter nodes:</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><em>intent: Yes</em></li>
<li><em>intent: No</em></li>
<li><em>intent: list more</em>.</li>
</ul>
</div></blockquote>
<p>We now have the capability of presenting a small number of choices, and going
down a list if necessary.</p>
<p>Your flow should now look like the following figure:</p>
<img alt="_images/Flow-7.png" class="align-center" src="_images/Flow-7.png" />
</div>
<div class="section" id="getting-a-choice-from-the-user">
<h3><a class="toc-backref" href="#id17">5. Getting a Choice from the User</a><a class="headerlink" href="#getting-a-choice-from-the-user" title="Permalink to this headline">¶</a></h3>
<p>Now we are ready to have the user choose a restaurant from the options presented
to them.</p>
<ol class="arabic simple">
<li>Add a new enter node called <em>intent: state choice</em> with the entrance conditions:</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.NLU.intent</span> <span class="pre">==</span> <span class="pre">state_choice</span></code></li>
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.kitt.yelp_results</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">null</span></code>.</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Connect to this enter node a new state node.</li>
<li>Name new state node, name it <em>repeat choice</em> and add the following code:</li>
</ol>
<blockquote>
<div><div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">choice</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
<span class="n">switch</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">NLU</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">enum_choice</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">case</span> <span class="s2">&quot;first&quot;</span><span class="p">:</span>
    <span class="n">case</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
    <span class="n">case</span> <span class="s2">&quot;one&quot;</span><span class="p">:</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="n">case</span> <span class="s2">&quot;two&quot;</span><span class="p">:</span>
    <span class="n">case</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span>
    <span class="n">case</span> <span class="s2">&quot;second&quot;</span><span class="p">:</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="n">case</span> <span class="s2">&quot;three&quot;</span><span class="p">:</span>
    <span class="n">case</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span>
    <span class="n">case</span> <span class="s2">&quot;3&quot;</span><span class="p">:</span>
    <span class="n">case</span> <span class="s2">&quot;third&quot;</span><span class="p">:</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="n">default</span><span class="p">:</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="n">choice</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Sorry, I didn&#39;t get what your choice was. &quot;</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">choice_name</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">yelp_results</span><span class="p">[</span><span class="n">choice</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">;</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Great, &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">yelp_results</span><span class="p">[</span><span class="n">choice</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;. &quot;</span><span class="p">;</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">user_choice</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">choice</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">msg</span><span class="o">.</span><span class="n">NLU</span><span class="o">.</span><span class="n">intent</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
<span class="k">return</span> <span class="n">msg</span><span class="p">;</span>
</pre></div>
</div>
<p>In this code, we check for the <code class="docutils literal"><span class="pre">NLU.entities.enum_choice</span></code> entity and set the
<code class="docutils literal"><span class="pre">choice</span></code> variable appropriately. If a choice is made, we set the user
variable <code class="docutils literal"><span class="pre">kitt.user_choice</span></code>, which we can access at any time in other nodes.</p>
</div></blockquote>
<p>Your flow should now look like the following figure:</p>
<img alt="_images/Flow-8.png" class="align-center" src="_images/Flow-8.png" />
</div>
<div class="section" id="answering-user-questions-about-the-choices-presented">
<h3><a class="toc-backref" href="#id18">6. Answering user questions about the choices presented</a><a class="headerlink" href="#answering-user-questions-about-the-choices-presented" title="Permalink to this headline">¶</a></h3>
<p>Great! Our bot can guide users to a choice, but what if the user has questions
about their choice and the other options?</p>
<p>Well, we can creat new flows to answer the users questions!</p>
<ol class="arabic simple">
<li>Add a new enter node, name it <em>intent: request rating</em> , and add three entrance conditions:</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.NLU.intent</span> <span class="pre">==</span> <span class="pre">request_rating</span></code></li>
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.kitt.user_choice</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">null</span></code></li>
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.NLU.entities.enum_choice</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">null</span></code></li>
</ul>
</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first">Create a state node called <em>say rating</em> and input the following code:</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">_responses</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;It&#39;s got &quot;</span> <span class="o">+</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">yelp_results</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">user_choice</span><span class="p">]</span><span class="o">.</span><span class="n">review_count</span> <span class="o">+</span>
    <span class="s2">&quot; reviews on Yelp, and the rating is &quot;</span> <span class="o">+</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">yelp_results</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">user_choice</span><span class="p">]</span><span class="o">.</span><span class="n">rating</span> <span class="o">+</span> <span class="s2">&quot; stars.&quot;</span><span class="p">];</span>

<span class="n">msg</span><span class="o">.</span><span class="n">NLU</span><span class="o">.</span><span class="n">intent</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
<span class="k">return</span> <span class="n">msg</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">To handle questions that refer to a specific restaurant, we add a new enter
node called <em>intent: rating request with choice</em> with the following entrance
conditions:</p>
</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.NLU.intent</span> <span class="pre">==</span> <span class="pre">request_rating</span></code></li>
<li><code class="docutils literal"><span class="pre">Property</span> <span class="pre">msg.NLU.entities.enum_choice</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">null</span></code></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="4">
<li>Connect this enter node to a new state node called <em>say rating by choice</em>, with the following code:</li>
</ol>
<blockquote>
<div><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">choice</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">status</span> <span class="o">=</span> <span class="s2">&quot;open&quot;</span><span class="p">;</span>

<span class="k">switch</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">NLU</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">enum_choice</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s2">&quot;first&quot;</span><span class="o">:</span>
    <span class="k">case</span> <span class="s2">&quot;1&quot;</span><span class="o">:</span>
    <span class="k">case</span> <span class="s2">&quot;one&quot;</span><span class="o">:</span>
        <span class="nx">choice</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s2">&quot;two&quot;</span><span class="o">:</span>
    <span class="k">case</span> <span class="s2">&quot;2&quot;</span><span class="o">:</span>
    <span class="k">case</span> <span class="s2">&quot;second&quot;</span><span class="o">:</span>
        <span class="nx">choice</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s2">&quot;three&quot;</span><span class="o">:</span>
    <span class="k">case</span> <span class="s2">&quot;last&quot;</span><span class="o">:</span>
    <span class="k">case</span> <span class="s2">&quot;3&quot;</span><span class="o">:</span>
    <span class="k">case</span> <span class="s2">&quot;third&quot;</span><span class="o">:</span>
        <span class="nx">choice</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="nx">choice</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">_responses</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="nx">choice</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">_responses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Sorry, I didn&#39;t get what your choice was. &quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">choice_name</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">yelp_results</span><span class="p">[</span><span class="nx">choice</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">name</span><span class="p">;</span>
    <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">user_choice</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">choice</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

   <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">_responses</span> <span class="o">=</span> <span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">yelp_results</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">user_choice</span><span class="p">].</span><span class="nx">name</span> <span class="o">+</span>
   <span class="s2">&quot; has &quot;</span> <span class="o">+</span>
    <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">yelp_results</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">user_choice</span><span class="p">].</span><span class="nx">review_count</span> <span class="o">+</span>
    <span class="s2">&quot;reviews on Yelp, and the rating is &quot;</span> <span class="o">+</span>
    <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">yelp_results</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">user_choice</span><span class="p">].</span><span class="nx">rating</span> <span class="o">+</span> <span class="s2">&quot;stars.&quot;</span><span class="p">];</span>
<span class="p">}</span>

<span class="nx">msg</span><span class="p">.</span><span class="nx">NLU</span><span class="p">.</span><span class="nx">intent</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="k">return</span> <span class="nx">msg</span><span class="p">;</span>
</pre></div>
</div>
<p>Here, we have a code that combines the code in <em>Say rating</em> and <em>repeat choice</em>
to generate a function that selects an output on the users input.</p>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can add similar flows to handle questions about address and hours.</p>
</div>
<p>Can we make our bot respond to gratitude? We sure can!</p>
<ol class="arabic simple" start="6">
<li>Add an enter node named <em>intent: thanking</em> with the entrance condition:<ul>
<li><code class="docutils literal"><span class="pre">Properties</span> <span class="pre">msg.NLU.intent</span> <span class="pre">==</span> <span class="pre">thanking</span></code></li>
</ul>
</li>
<li>Add a state named <em>respond to thanks</em>, add the following code:</li>
</ol>
<blockquote>
<div><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">_responses</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;No problem. &#39;</span><span class="p">,</span> <span class="s1">&#39;Sure, any time. &#39;</span><span class="p">,</span> <span class="s1">&#39;Glad to help. &#39;</span><span class="p">,</span> <span class="s1">&#39;Any time. &#39;</span><span class="p">]</span>

<span class="nx">msg</span><span class="p">.</span><span class="nx">NLU</span><span class="p">.</span><span class="nx">intent</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="k">return</span> <span class="nx">msg</span><span class="p">;</span>
</pre></div>
</div>
<p>This code stores a set of appropriate responses and randomly selects one to output!</p>
</div></blockquote>
<p>Well, what if our bot does not understand our user? We can create a flow to
handle that!</p>
<ol class="arabic simple" start="8">
<li>Add an enter node named <em>intent: default</em> with the entrance condition:<ul>
<li><code class="docutils literal"><span class="pre">Properties</span> <span class="pre">msg.NLU.intent</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">null</span></code></li>
</ul>
</li>
<li>Add a state named <em>Non understanding</em> and add the following code:</li>
</ol>
<blockquote>
<div><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">_responses</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Sorry, I didn&#39;t get what you said. &quot;</span><span class="p">,</span>
    <span class="s2">&quot;Oops, I&#39;m not sure I understand. &quot;</span><span class="p">,</span>
    <span class="s2">&quot;Hmm, not sure I understand. &quot;</span><span class="p">];</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">address</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">businesstype</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;I should point out that I&#39;m not good at understanding the names of businesses, so when I give you choices, just say first, second, or one, two, and so on. &quot;</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">_responses</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">_responses</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">str</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">address</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">businesstype</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;Zip code might be easier for me. Or try something easy. &quot;</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">_responses</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">_responses</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">str</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">businesstype</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;I&#39;m not good at business types at this point. Please try something simple. &quot;</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">_responses</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">_responses</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">str</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">msg</span><span class="p">.</span><span class="nx">NLU</span><span class="p">.</span><span class="nx">intent</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="k">return</span> <span class="nx">msg</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This outcome is mostly likely a results from an <a class="reference external" href="https://nlu.kitt.ai/">NLU</a> error.
Although it is crucially important to make sure the NLU performs adequately,
it is also important to understand that the NLU will make mistakes. Make sure
your flow can account for those mistakes.</p>
</div>
</div></blockquote>
<p>Finally, we can create a flow that will end our dialogue with our user.</p>
<ol class="arabic simple" start="10">
<li>Add an enter node named <em>closing</em> with the entrance condition:</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">Properties</span> <span class="pre">msg.NLU.intent</span> <span class="pre">==</span> <span class="pre">goodbye</span></code></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="11">
<li>Add a state named <em>good bye</em>, add the output text <em>Goodbye</em> check the
<em>Dialogue ends here</em> box.</li>
</ol>
<p>Your flow should now look like the following figure:</p>
<img alt="_images/Flow-9.png" class="align-center" src="_images/Flow-9.png" />
</div>
</div>
<div class="section" id="final-thoughts">
<h2><a class="toc-backref" href="#id19">Final Thoughts</a><a class="headerlink" href="#final-thoughts" title="Permalink to this headline">¶</a></h2>
<p>That&#8217;s it! We now have a fully functional conversational interface to Yelp. Can
you make it better? (Of course you can!)</p>
<img alt="_images/superflow.png" class="align-center" src="_images/superflow.png" />
<p>In addition, you can import and play with the application by either:</p>
<blockquote>
<div><ul class="simple">
<li>Downloading the <a class="reference download internal" href="_downloads/yelp.json" download=""><code class="xref download docutils literal"><span class="pre">JSON</span></code></a> file for our
application and importing the project on the <a class="reference external" href="https://chatflow.kitt.ai/apps">applications</a>
page</li>
<li>Creating a new project form the &#8220;Yelp Bot&#8221; sample application under &#8220;Use a
Sample Project&#8221; on the <a class="reference external" href="https://chatflow.kitt.ai/apps">applications</a> page.</li>
</ul>
</div></blockquote>
<p>Happy Bot Building!</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="telegram.html" class="btn btn-neutral float-right" title="Telegram Bot Tutorials" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="debug.html" class="btn btn-neutral" title="Debug ChatFlow" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p  style="color:#999;">
        &copy; Copyright 2016, KITT.AI.
      Last updated on Nov 14, 2016.

    </p>
  </div> 

  <div>

    <p>
      Made with <i class="fa fa-heart" style="color:red;"></i> in the city of
      <i class="fa fa-coffee" style="color:#6F4E37;"></i>
      <i class="fa fa-umbrella" style="color:#007FFF;"></i>
      <i class="fa fa-plane" style="color:#0F52BA;"></i>
      <i class="fa fa-diamond" style="color:#50C878;"></i>
    </p>
  </div>

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/js/anchor.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>