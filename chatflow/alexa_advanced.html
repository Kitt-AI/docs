

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Advanced Alexa Skill Tutorial &mdash; ChatFlow 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ChatFlow 0.1 documentation" href="index.html"/>
        <link rel="next" title="Advanced Alexa Skill Tutorial with NLU" href="alexa_nlu.html"/>
        <link rel="prev" title="Alexa Skill Tutorials" href="alexa.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> ChatFlow
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Welcome to ChatFlow</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">ChatFlow Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#accessing-chatflow">Accessing ChatFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#a-first-conversational-flow-from-a-template">A first conversational flow (from a template)</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#another-simple-flow-from-scratch">Another simple flow, from scratch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#the-conversational-router">The conversational router</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#enter-nodes">Enter nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#state-nodes">State nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#adding-input-and-output">Adding input and output</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#dealing-with-natural-language-input">Dealing with natural language input</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dialogue_nodes.html">Dialogue Nodes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dialogue_nodes.html#nodes-in-chatflow">Nodes in ChatFlow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dialogue_nodes.html#basic-flow-input-and-output">Basic Flow, Input and Output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dialogue_nodes.html#router">Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="dialogue_nodes.html#enter-nodes">Enter Nodes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dialogue_nodes.html#ordering-preferences">Ordering preferences</a></li>
<li class="toctree-l3"><a class="reference internal" href="dialogue_nodes.html#direct-link">Direct link</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dialogue_nodes.html#state-nodes">State Nodes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dialogue_nodes.html#final-state">Final state</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dialogue_nodes.html#nlu">NLU</a></li>
<li class="toctree-l2"><a class="reference internal" href="dialogue_nodes.html#api-nodes">API Nodes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extended_example.html">Extended Example: A conversational Yelp bot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="extended_example.html#starting-your-conversational-project">Starting your conversational project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#adding-an-nlu-node">Adding an NLU node</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="extended_example.html#creating-your-flow">Creating your flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#initialization">Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#prompting-the-user-and-understanding-the-user-s-request">Prompting the user and understanding the user&#8217;s request</a></li>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#fulfilling-the-user-s-request-through-a-yelp-query">Fulfilling the user&#8217;s request through a Yelp query</a></li>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#presenting-yelp-results-to-the-user">Presenting Yelp results to the user</a></li>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#getting-a-choice-from-the-user">Getting a choice from the user</a></li>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#answering-user-questions-about-the-choices-presented">Answering user questions about the choices presented</a></li>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#final-thoughts">Final thoughts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="telegram.html">Telegram Bot Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="telegram.html#a-simple-echo-bot">A simple Echo Bot</a></li>
<li class="toctree-l2"><a class="reference internal" href="telegram.html#setting-up-inline-bot">Setting up Inline Bot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="telegram.html#set-inline-status">Set inline status</a></li>
<li class="toctree-l3"><a class="reference internal" href="telegram.html#set-inline-location-awareness">Set inline location awareness</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="telegram.html#an-inline-yelp-bot">An inline Yelp Bot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="telegram.html#the-flow">The flow</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="slack.html">Slack Bot Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="slack.html#abstract">Abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="slack.html#a-simple-echo-bot">A simple echo bot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="slack.html#create-a-new-slack-bot">1. Create a new slack bot</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#copy-bot-api-token">2. Copy Bot API Token</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#create-a-new-chatflow-application">3. Create a new ChatFlow application</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#configure-the-bot">4. Configure the bot</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#deploy-the-application">5. Deploy the application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="slack.html#advanced-slash-commands-and-interactive-messages">Advanced: slash commands and interactive messages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="slack.html#creating-a-slack-application">1. Creating a slack application</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#importing-the-cat-choose-application">2. Importing the &#8220;Cat Choose&#8221; application</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#nlu-setup">3. NLU setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#slack-app-setup">4. Slack app setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="slack.html#slash-command">Slash command</a></li>
<li class="toctree-l4"><a class="reference internal" href="slack.html#id6">Interactive messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="slack.html#redirect-url">Redirect URL</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#connect-your-slack-application-with-your-team">5. Connect your slack application with your team</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#testing-the-cat-choose-application">6. Testing the &#8220;Cat Choose&#8221; application</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="twilio.html">Twilio Bot Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="twilio.html#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="twilio.html#preparing-twilio-account">Preparing Twilio account</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="twilio.html#a-simple-backwards-echo-bot">A simple Backwards-echo Bot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="twilio.html#extra-steps">Extra steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="twilio.html#a-more-advanced-twilio-bot-with-session-router-support">A more advanced Twilio bot with session/router support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="kik.html">Kik Bot Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="kik.html#abstract">Abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="kik.html#a-simple-echo-bot">A simple echo bot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="kik.html#create-a-kik-bot">1. Create a kik bot</a></li>
<li class="toctree-l3"><a class="reference internal" href="kik.html#create-a-chatflow-application">2. Create a ChatFlow application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kik.html#advanced-attachments-and-custom-keyboards">Advanced: attachments and custom keyboards</a><ul>
<li class="toctree-l3"><a class="reference internal" href="kik.html#importing-the-colored-cats-application">1. Importing the &#8220;Colored Cats&#8221; application</a></li>
<li class="toctree-l3"><a class="reference internal" href="kik.html#nlu-setup">2. NLU setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="kik.html#set-up-colored-cats-application">3. Set up &#8220;Colored Cats&#8221; application</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="alexa.html">Alexa Skill Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="alexa.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="alexa.html#create-an-alexa-copy-cat-chatflow-app">Create an Alexa Copy Cat Chatflow app</a></li>
<li class="toctree-l2"><a class="reference internal" href="alexa.html#create-a-copy-cat-echo-skill">Create a Copy Cat Echo skill</a><ul>
<li class="toctree-l3"><a class="reference internal" href="alexa.html#create-an-alexa-skill">Create an Alexa Skill</a><ul>
<li class="toctree-l4"><a class="reference internal" href="alexa.html#skill-information">1. Skill Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="alexa.html#sample-utterances">2. Sample Utterances</a></li>
<li class="toctree-l4"><a class="reference internal" href="alexa.html#configuration">3. Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="alexa.html#ssl-certificate">4. SSL Certificate</a></li>
<li class="toctree-l4"><a class="reference internal" href="alexa.html#test">5. Test</a></li>
<li class="toctree-l4"><a class="reference internal" href="alexa.html#finishing-up">6. Finishing up</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="alexa.html#test-your-skill-with-an-echo">Test your skill with an Echo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="alexa.html#incoming-message-structures">Incoming Message Structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="alexa.html#launch-skill">Launch Skill</a></li>
<li class="toctree-l3"><a class="reference internal" href="alexa.html#intent-request">Intent Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="alexa.html#card-and-reprompt">Card and Reprompt</a></li>
<li class="toctree-l3"><a class="reference internal" href="alexa.html#ask-or-tell">Ask or Tell?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="alexa.html#more-advanced-tutorials">More Advanced Tutorials</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Advanced Alexa Skill Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wiseguy-tell-a-knock-knock-joke">WiseGuy: tell a Knock Knock joke</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-the-wiseguy-chatflow-app">Create the WiseGuy ChatFlow app</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-the-wiseguy-alexa-skill">Create the WiseGuy Alexa Skill</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multi-turn-and-state-tracking-explained">Multi turn and state tracking explained</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-global-variable">The <code class="docutils literal"><span class="pre">global</span></code> variable</a></li>
<li class="toctree-l3"><a class="reference internal" href="#state-tracking">State tracking</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="alexa_nlu.html">Advanced Alexa Skill Tutorial with NLU</a><ul>
<li class="toctree-l2"><a class="reference internal" href="alexa_nlu.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="alexa_nlu.html#create-an-nlu-project">Create an NLU Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="alexa_nlu.html#exporting-to-alexa-format">Exporting to Alexa Format</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ChatFlow</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Advanced Alexa Skill Tutorial</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/alexa_advanced.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="advanced-alexa-skill-tutorial">
<span id="alexa-advanced-title"></span><h1><a class="toc-backref" href="#id2">Advanced Alexa Skill Tutorial</a><a class="headerlink" href="#advanced-alexa-skill-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#advanced-alexa-skill-tutorial" id="id2">Advanced Alexa Skill Tutorial</a><ul>
<li><a class="reference internal" href="#introduction" id="id3">Introduction</a></li>
<li><a class="reference internal" href="#wiseguy-tell-a-knock-knock-joke" id="id4">WiseGuy: tell a Knock Knock joke</a></li>
<li><a class="reference internal" href="#create-the-wiseguy-chatflow-app" id="id5">Create the WiseGuy ChatFlow app</a></li>
<li><a class="reference internal" href="#create-the-wiseguy-alexa-skill" id="id6">Create the WiseGuy Alexa Skill</a></li>
<li><a class="reference internal" href="#multi-turn-and-state-tracking-explained" id="id7">Multi turn and state tracking explained</a><ul>
<li><a class="reference internal" href="#the-global-variable" id="id8">The <code class="docutils literal"><span class="pre">global</span></code> variable</a></li>
<li><a class="reference internal" href="#state-tracking" id="id9">State tracking</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<span id="intro"></span><h2><a class="toc-backref" href="#id3">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we will walk through a more complex Alexa skill that
tells the <em>knock knock</em> joke. You will learn:</p>
<ul class="simple">
<li>Using multiple intents with slots (entities) in an Alexa sample app</li>
<li>Creating a multi-turn conversation</li>
<li>Managing and tracking dialogue states</li>
</ul>
</div>
<div class="section" id="wiseguy-tell-a-knock-knock-joke">
<h2><a class="toc-backref" href="#id4">WiseGuy: tell a Knock Knock joke</a><a class="headerlink" href="#wiseguy-tell-a-knock-knock-joke" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/amzn/alexa-skills-kit-js/tree/master/samples/wiseGuy">Wise Guy</a> is a sample Alexa skill that tells the <em>knock knock</em> joke:</p>
<p><em>You: &#8220;Alexa, ask Wise Guy to tell a joke&#8221;</em></p>
<p><em>Echo: &#8220;Knock knock&#8221;</em></p>
<p><em>You: &#8220;who&#8217;s there?&#8221;</em></p>
<p><em>Echo: &#8220;Beets!&#8221;</em></p>
<p><em>You: &#8220;Beets who?&#8221;</em></p>
<p><em>Echo: &#8220;Beats me!&#8221;</em></p>
<p>However, it shows multi-turn ability with dialogue state tracking. At any given
point, users can ask for help and Echo would explain how to proceed.</p>
<p>The main source files are the <a class="reference external" href="https://github.com/amzn/alexa-skills-kit-js/tree/master/samples/wiseGuy/speechAssets">Speech Assets</a>
and <a class="reference external" href="https://github.com/amzn/alexa-skills-kit-js/blob/master/samples/wiseGuy/src/index.js">index.js</a> file.</p>
<p>We&#8217;ll see how to easily recreate this application with ChatFlow and a more
intuitive interface.</p>
</div>
<div class="section" id="create-the-wiseguy-chatflow-app">
<h2><a class="toc-backref" href="#id5">Create the WiseGuy ChatFlow app</a><a class="headerlink" href="#create-the-wiseguy-chatflow-app" title="Permalink to this headline">¶</a></h2>
<p>Go to <a class="reference external" href="https://chatflow.kitt.ai/">ChatFlow</a> and use the sample application &#8220;Alexa WiseGuy Skill&#8221;:</p>
<img alt="_images/chatflow-wise-guy-app.png" class="align-center" src="_images/chatflow-wise-guy-app.png" />
<p>The application can almost work out of the box. All we need to do is to copy
the &#8220;Final URL&#8221; from the <strong>Alexa In</strong> node after hitting &#8220;DEPLOY&#8221;.</p>
</div>
<div class="section" id="create-the-wiseguy-alexa-skill">
<h2><a class="toc-backref" href="#id6">Create the WiseGuy Alexa Skill</a><a class="headerlink" href="#create-the-wiseguy-alexa-skill" title="Permalink to this headline">¶</a></h2>
<p>Now please follow the steps in <a class="reference internal" href="alexa.html#create-an-alexa-skill"><span>Create an Alexa Skill</span></a> to create a skill
for Wise Guy. In Step <a class="reference internal" href="alexa.html#sample-utterances"><span>2. Sample Utterances</span></a> you&#8217;ll need to input
<a class="reference external" href="https://github.com/amzn/alexa-skills-kit-js/tree/master/samples/wiseGuy/speechAssets">Speech Assets</a>.</p>
<p><strong>Intent Schema</strong>:</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;intents&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;intent&quot;</span><span class="o">:</span> <span class="s2">&quot;TellMeAJokeIntent&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;intent&quot;</span><span class="o">:</span> <span class="s2">&quot;WhosThereIntent&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
     <span class="s2">&quot;intent&quot;</span><span class="o">:</span> <span class="s2">&quot;SetupNameWhoIntent&quot;</span><span class="p">,</span>
     <span class="s2">&quot;slots&quot;</span><span class="o">:</span><span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;SetupName&quot;</span><span class="p">,</span>
          <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;LIST_OF_SETUP_NAMES&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;intent&quot;</span><span class="o">:</span> <span class="s2">&quot;AMAZON.HelpIntent&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;intent&quot;</span><span class="o">:</span> <span class="s2">&quot;AMAZON.StopIntent&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;intent&quot;</span><span class="o">:</span> <span class="s2">&quot;AMAZON.CancelIntent&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p><strong>LIST_OF_SETUP_NAMES</strong></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">to</span>
<span class="nx">beets</span>
<span class="nx">little</span> <span class="nx">Old</span> <span class="nx">Lady</span>
<span class="nx">a</span> <span class="nx">broken</span> <span class="nx">pencil</span>
<span class="nx">snow</span>
<span class="nx">boo</span>
<span class="nx">woo</span>
<span class="nx">spell</span>
<span class="nx">atch</span>
<span class="nx">owls</span>
<span class="nx">berry</span>
</pre></div>
</div>
<p><strong>Sample Utterances</strong>:</p>
<div class="highlight-java"><div class="highlight"><pre>TellMeAJokeIntent tell me a joke
TellMeAJokeIntent tell a joke
TellMeAJokeIntent say a joke
TellMeAJokeIntent make a joke
TellMeAJokeIntent give me a joke
TellMeAJokeIntent tell me a knock knock joke
TellMeAJokeIntent tell a knock knock joke
TellMeAJokeIntent say a knock knock joke
TellMeAJokeIntent make a knock knock joke
TellMeAJokeIntent give me a knock knock joke
TellMeAJokeIntent a joke
TellMeAJokeIntent a knock knock joke
TellMeAJokeIntent the joke
TellMeAJokeIntent the knock knock joke
TellMeAJokeIntent what&#39;s a joke
TellMeAJokeIntent what is a joke
TellMeAJokeIntent if it can tell me a joke
TellMeAJokeIntent will it tell me a joke
TellMeAJokeIntent can it tell me a joke
TellMeAJokeIntent to tell me a joke
TellMeAJokeIntent what&#39;s a knock knock joke
TellMeAJokeIntent what is a knock knock joke
TellMeAJokeIntent if it can tell me a knock knock joke
TellMeAJokeIntent will it tell me a knock knock joke
TellMeAJokeIntent can it tell me a knock knock joke
TellMeAJokeIntent to tell me a knock knock joke

WhosThereIntent who is there
WhosThereIntent who&#39;s there
WhosThereIntent who there
WhosThereIntent who is this
WhosThereIntent who&#39;s this

SetupNameWhoIntent {SetupName} who
</pre></div>
</div>
<p>Now we are all set! Use the Service Simulator or your Echo device to test it!</p>
</div>
<div class="section" id="multi-turn-and-state-tracking-explained">
<h2><a class="toc-backref" href="#id7">Multi turn and state tracking explained</a><a class="headerlink" href="#multi-turn-and-state-tracking-explained" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-global-variable">
<h3><a class="toc-backref" href="#id8">The <code class="docutils literal"><span class="pre">global</span></code> variable</a><a class="headerlink" href="#the-global-variable" title="Permalink to this headline">¶</a></h3>
<p>Now let&#8217;s come back to the ChatFlow app. We have a <code class="docutils literal"><span class="pre">JOKE_LIST</span></code> that&#8217;s used
across the dialogue. We set it in the <strong>init JOKE_LIST</strong> state node:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">JOKE_LIST</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="nx">setup</span><span class="o">:</span> <span class="s2">&quot;To&quot;</span><span class="p">,</span> <span class="nx">speechPunchline</span><span class="o">:</span> <span class="s2">&quot;Correct grammar is &lt;break time=\&quot;0.2s\&quot; /&gt; to whom.&quot;</span><span class="p">,</span>
    <span class="nx">cardPunchline</span><span class="o">:</span> <span class="s2">&quot;Correct grammar is &#39;to whom&#39;.&quot;</span><span class="p">},</span>
    <span class="p">...</span>
<span class="p">]</span>
<span class="nx">global</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;JOKE_LIST&quot;</span><span class="p">,</span> <span class="nx">JOKE_LIST</span><span class="p">);</span>
</pre></div>
</div>
<p>Then later we can use:</p>
<div class="highlight-python"><div class="highlight"><pre>var JOKE_LIST = global.get(&quot;JOKE_LIST&quot;);
</pre></div>
</div>
<p>to retrieve this variable in any function or state node. The <code class="docutils literal"><span class="pre">global</span></code> environment
has a scope to current application, i.e., one application cannot access another
application&#8217;s <code class="docutils literal"><span class="pre">global</span></code> environment.</p>
<p>Also, in the <strong>init JOKE_LIST</strong> state node, we initialized the dialogue stage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="state-tracking">
<h3><a class="toc-backref" href="#id9">State tracking</a><a class="headerlink" href="#state-tracking" title="Permalink to this headline">¶</a></h3>
<p>Now take a look at the <strong>Tell Me A Joke</strong> state node, it sets up the dialogue stage:</p>
<a class="reference internal image-reference" href="_images/tell-me-a-joke.png"><img alt="_images/tell-me-a-joke.png" class="align-center" src="_images/tell-me-a-joke.png" style="width: 400px;" /></a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the <em>request user input</em> click at the bottom of state node indicates
the router to send message out at this state node <em>right away</em> without
attempting to visit another enter/state node.</p>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">//Select a random joke and store it in the session variables.</span>
<span class="kd">var</span> <span class="nx">jokeID</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">JOKE_LIST</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>

<span class="c1">//The stage variable tracks the phase of the dialogue.</span>
<span class="c1">//When this function completes, it will be on stage 1.</span>
<span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">stage</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">setup</span> <span class="o">=</span> <span class="nx">JOKE_LIST</span><span class="p">[</span><span class="nx">jokeID</span><span class="p">].</span><span class="nx">setup</span><span class="p">;</span>
<span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">speechPunchline</span> <span class="o">=</span> <span class="nx">JOKE_LIST</span><span class="p">[</span><span class="nx">jokeID</span><span class="p">].</span><span class="nx">speechPunchline</span><span class="p">;</span>
<span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">cardPunchline</span> <span class="o">=</span> <span class="nx">JOKE_LIST</span><span class="p">[</span><span class="nx">jokeID</span><span class="p">].</span><span class="nx">cardPunchline</span><span class="p">;</span>
</pre></div>
</div>
<p>Remember that everything in <code class="docutils literal"><span class="pre">msg.kitt</span></code> is maintained by the dialogue router,
persisting over the whole dialogue session. Thus next time a new utterance within
the <em>same</em> dialogue session comes in, previous turn&#8217;s <code class="docutils literal"><span class="pre">msg.kitt</span></code> can still be
accessed. <code class="docutils literal"><span class="pre">msg.kitt</span></code> is also assigned to <code class="docutils literal"><span class="pre">sessionAttributes</span></code> when <em>outputting</em>
through <strong>Alexa Out</strong> and persisted by the Alexa service. So next time an Alexa
<a class="reference external" href="https://developer.amazon.com/public/solutions/alexa/alexa-skills-kit/docs/alexa-skills-kit-interface-reference#request-format">Request</a>
comes in, the same session attributes can be accessed via <code class="docutils literal"><span class="pre">msg.alexa.session.attributes</span></code>
(maintained by Alexa), or <code class="docutils literal"><span class="pre">msg.kitt</span></code> (maintained by ChatFlow).</p>
<p>The <strong>Who&#8217;s There</strong> state node then advances the dialogue stage by 1 if previous
<code class="docutils literal"><span class="pre">msg.kitt.stage</span> <span class="pre">==</span> <span class="pre">1</span></code>:</p>
<a class="reference internal image-reference" href="_images/whos-there.png"><img alt="_images/whos-there.png" class="align-center" src="_images/whos-there.png" style="width: 400px;" /></a>
<div class="highlight-javascript"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">stage</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Retrieve the joke&#39;s setup text.</span>
    <span class="nx">speechText</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">setup</span><span class="p">;</span>

    <span class="c1">//Advance the stage of the dialogue.</span>
    <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">stage</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="nx">repromptText</span> <span class="o">=</span> <span class="s2">&quot;You can ask, &quot;</span> <span class="o">+</span> <span class="nx">speechText</span> <span class="o">+</span> <span class="s2">&quot; who?&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Similarly, the <strong>Setup Name Who</strong> state node advances the dialogue stage by 1 if previous
<code class="docutils literal"><span class="pre">msg.kitt.stage</span> <span class="pre">==</span> <span class="pre">2</span></code>:</p>
<a class="reference internal image-reference" href="_images/setup-name-who.png"><img alt="_images/setup-name-who.png" class="align-center" src="_images/setup-name-who.png" style="width: 400px;" /></a>
<div class="highlight-javascript"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">stage</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">speechText</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">speechPunchline</span><span class="p">;</span>
    <span class="nx">cardOutput</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">cardPunchline</span><span class="p">;</span>
    <span class="nx">msg</span><span class="p">.</span><span class="nx">alexa</span><span class="p">.</span><span class="nx">outputSpeech</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">ssml</span><span class="o">:</span> <span class="s1">&#39;&lt;speak&gt;&#39;</span> <span class="o">+</span> <span class="nx">speechText</span> <span class="o">+</span> <span class="s1">&#39;&lt;/speak&gt;&#39;</span><span class="p">,</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;SSML&quot;</span>
    <span class="p">};</span>
    <span class="c1">// the joke completes successfully, end session.</span>
    <span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">_session_ended</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">msg</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It also sets <code class="docutils literal"><span class="pre">msg.kitt._session_ended</span> <span class="pre">=</span> <span class="pre">true;</span></code> because that&#8217;s end of the
<em>knock knock</em> joke!</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="alexa_nlu.html" class="btn btn-neutral float-right" title="Advanced Alexa Skill Tutorial with NLU" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="alexa.html" class="btn btn-neutral" title="Alexa Skill Tutorials" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, KITT.AI.
      Last updated on Aug 18, 2016.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>