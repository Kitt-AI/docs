

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Dialogue Nodes &mdash; ChatFlow 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ChatFlow 0.1 documentation" href="index.html"/>
        <link rel="next" title="Extended Example: A conversational Yelp bot" href="extended_example.html"/>
        <link rel="prev" title="ChatFlow Quick Start" href="quickstart.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> ChatFlow
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">ChatFlow Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#accessing-chatflow">Accessing ChatFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#a-first-conversational-flow-from-a-template">A first conversational flow (from a template)</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#another-simple-flow-from-scratch">Another simple flow, from scratch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#the-conversational-router">The conversational router</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#enter-nodes">Enter nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#state-nodes">State nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#adding-input-and-output">Adding input and output</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#dealing-with-natural-language-input">Dealing with natural language input</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Dialogue Nodes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#nodes-in-chatflow">Nodes in ChatFlow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-flow-input-and-output">Basic Flow, Input and Output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#router">Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enter-nodes">Enter Nodes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ordering-preferences">Ordering preferences</a></li>
<li class="toctree-l3"><a class="reference internal" href="#direct-link">Direct link</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#state-nodes">State Nodes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#final-state">Final state</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nlu">NLU</a></li>
<li class="toctree-l2"><a class="reference internal" href="#api-nodes">API Nodes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extended_example.html">Extended Example: A conversational Yelp bot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="extended_example.html#starting-your-conversational-project">Starting your conversational project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#adding-an-nlu-node">Adding an NLU node</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="extended_example.html#creating-your-flow">Creating your flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#initialization">Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#prompting-the-user-and-understanding-the-user-s-request">Prompting the user and understanding the user&#8217;s request</a></li>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#fulfilling-the-user-s-request-through-a-yelp-query">Fulfilling the user&#8217;s request through a Yelp query</a></li>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#presenting-yelp-results-to-the-user">Presenting Yelp results to the user</a></li>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#getting-a-choice-from-the-user">Getting a choice from the user</a></li>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#answering-user-questions-about-the-choices-presented">Answering user questions about the choices presented</a></li>
<li class="toctree-l3"><a class="reference internal" href="extended_example.html#final-thoughts">Final thoughts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="telegram.html">Telegram Bot Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="telegram.html#a-simple-echo-bot">A simple Echo Bot</a></li>
<li class="toctree-l2"><a class="reference internal" href="telegram.html#setting-up-inline-bot">Setting up Inline Bot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="telegram.html#set-inline-status">Set inline status</a></li>
<li class="toctree-l3"><a class="reference internal" href="telegram.html#set-inline-location-awareness">Set inline location awareness</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="telegram.html#an-inline-yelp-bot">An inline Yelp Bot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="telegram.html#the-flow">The flow</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="slack.html">Slack Bot Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="slack.html#abstract">Abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="slack.html#a-simple-echo-bot">A simple echo bot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="slack.html#create-a-new-slack-bot">1. Create a new slack bot</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#copy-bot-api-token">2. Copy Bot API Token</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#create-a-new-chatflow-application">3. Create a new ChatFlow application</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#configure-the-bot">4. Configure the bot</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#deploy-the-application">5. Deploy the application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="slack.html#advanced-slash-commands-and-interactive-messages">Advanced: slash commands and interactive messages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="slack.html#creating-a-slack-application">1. Creating a slack application</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#importing-the-cat-choose-application">2. Importing the &#8220;Cat Choose&#8221; application</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#nlu-setup">3. NLU setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#slack-app-setup">4. Slack app setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="slack.html#slash-command">Slash command</a></li>
<li class="toctree-l4"><a class="reference internal" href="slack.html#id6">Interactive messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="slack.html#redirect-url">Redirect URL</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#connect-your-slack-application-with-your-team">5. Connect your slack application with your team</a></li>
<li class="toctree-l3"><a class="reference internal" href="slack.html#testing-the-cat-choose-application">6. Testing the &#8220;Cat Choose&#8221; application</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="twilio.html">Twilio Bot Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="twilio.html#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="twilio.html#preparing-twilio-account">Preparing Twilio account</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="twilio.html#a-simple-backwards-echo-bot">A simple Backwards-echo Bot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="twilio.html#extra-steps">Extra steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="twilio.html#a-more-advanced-twilio-bot-with-session-router-support">A more advanced Twilio bot with session/router support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="kik.html">Kik Bot Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="kik.html#abstract">Abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="kik.html#a-simple-echo-bot">A simple echo bot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="kik.html#create-a-kik-bot">1. Create a kik bot</a></li>
<li class="toctree-l3"><a class="reference internal" href="kik.html#create-a-chatflow-application">2. Create a ChatFlow application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kik.html#advanced-attachments-and-custom-keyboards">Advanced: attachments and custom keyboards</a><ul>
<li class="toctree-l3"><a class="reference internal" href="kik.html#importing-the-colored-cats-application">1. Importing the &#8220;Colored Cats&#8221; application</a></li>
<li class="toctree-l3"><a class="reference internal" href="kik.html#nlu-setup">2. NLU setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="kik.html#set-up-colored-cats-application">3. Set up &#8220;Colored Cats&#8221; application</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="alexa.html">Alexa Skill Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="alexa.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="alexa.html#create-an-alexa-copy-cat-chatflow-app">Create an Alexa Copy Cat Chatflow app</a></li>
<li class="toctree-l2"><a class="reference internal" href="alexa.html#create-a-copy-cat-echo-skill">Create a Copy Cat Echo skill</a><ul>
<li class="toctree-l3"><a class="reference internal" href="alexa.html#create-an-alexa-skill">Create an Alexa Skill</a><ul>
<li class="toctree-l4"><a class="reference internal" href="alexa.html#skill-information">1. Skill Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="alexa.html#sample-utterances">2. Sample Utterances</a></li>
<li class="toctree-l4"><a class="reference internal" href="alexa.html#configuration">3. Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="alexa.html#ssl-certificate">4. SSL Certificate</a></li>
<li class="toctree-l4"><a class="reference internal" href="alexa.html#test">5. Test</a></li>
<li class="toctree-l4"><a class="reference internal" href="alexa.html#finishing-up">6. Finishing up</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="alexa.html#test-your-skill-with-an-echo">Test your skill with an Echo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="alexa.html#incoming-message-structures">Incoming Message Structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="alexa.html#launch-skill">Launch Skill</a></li>
<li class="toctree-l3"><a class="reference internal" href="alexa.html#intent-request">Intent Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="alexa.html#card-and-reprompt">Card and Reprompt</a></li>
<li class="toctree-l3"><a class="reference internal" href="alexa.html#ask-or-tell">Ask or Tell?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="alexa.html#more-advanced-tutorials">More Advanced Tutorials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="alexa_advanced.html">Advanced Alexa Skill Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="alexa_advanced.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="alexa_advanced.html#wiseguy-tell-a-knock-knock-joke">WiseGuy: tell a Knock Knock joke</a></li>
<li class="toctree-l2"><a class="reference internal" href="alexa_advanced.html#create-the-wiseguy-chatflow-app">Create the WiseGuy Chatflow app</a></li>
<li class="toctree-l2"><a class="reference internal" href="alexa_advanced.html#create-the-wiseguy-alexa-skill">Create the WiseGuy Alexa Skill</a></li>
<li class="toctree-l2"><a class="reference internal" href="alexa_advanced.html#multi-turn-and-state-tracking-explained">Multi turn and state tracking explained</a><ul>
<li class="toctree-l3"><a class="reference internal" href="alexa_advanced.html#the-global-variable">The <code class="docutils literal"><span class="pre">global</span></code> variable</a></li>
<li class="toctree-l3"><a class="reference internal" href="alexa_advanced.html#state-tracking">State tracking</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ChatFlow</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Dialogue Nodes</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/dialogue_nodes.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="dialogue-nodes">
<span id="id1"></span><h1>Dialogue Nodes<a class="headerlink" href="#dialogue-nodes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="nodes-in-chatflow">
<h2>Nodes in ChatFlow<a class="headerlink" href="#nodes-in-chatflow" title="Permalink to this headline">¶</a></h2>
<p>ChatFlow conversational content is represented as nodes in a network, and
the links, or wires, between these nodes. Nodes have inputs, where they receive
messages, and outputs, where they send messages. Execution of the
network, or running the conversation, happens through the flow of
messages among the nodes in the network.</p>
<div class="section" id="basic-flow-input-and-output">
<h3>Basic Flow, Input and Output<a class="headerlink" href="#basic-flow-input-and-output" title="Permalink to this headline">¶</a></h3>
<p>In a ChatFlow conversation, messages typically originate in an input
node from the <strong>bots</strong> section of the node palette. For example,
<em>Alexa In</em>, <em>Cortana In</em>, and <em>Slack Bot In</em> nodes are available to
create and send messages based on user input coming from
Amazon Echo, Microsoft Cortana or Slack. These input nodes do not
receive messages from other nodes, so you will notice they do not
accept incoming wires.</p>
<p>Once an input node receives user input (e.g. from Slack, from the chat
tab within ChatFlow, from an Amazon Echo device, etc.), it sends out a message
through its output. The message created by an input node will contain
a <code class="docutils literal"><span class="pre">payload</span></code> property that holds a string corresponding to the
user natural language input. Through a wire originating at the input node,
this message typically goes to a <strong>Natural Language Understanding (NLU)</strong>
node, which maps the natural language input into symbols that drive
the ChatFlow interaction. The NLU results are added to the message as
a property called <code class="docutils literal"><span class="pre">NLU</span></code>, and in a typically flow the message is then
sent through a wire to the <strong>router</strong> node.</p>
<p>The router node then directs the message through a network of <strong>enter</strong> nodes
and <strong>state</strong> nodes, which are not connected to the router by wires.
This process, described in the more detail under the router section of
the documentation, generates a system utterance, which the router
places in its outgoing message as a string in the <code class="docutils literal"><span class="pre">payload</span></code> property. The router then sends
the message out through a wire, which is typically connected to an
output node matching the input node used, i.e., text is sent to Slack, or
an Amazon Echo, etc.</p>
<p>The basic node types used in most ChatFlow conversations are:</p>
<dl class="docutils">
<dt>input</dt>
<dd>An input node generates a message based on external user input,
which is usually a natural language utterance. The string corresponding
to the user input is accessible in the message sent by the input node
as <code class="docutils literal"><span class="pre">msg.payload</span></code>.</dd>
<dt>output</dt>
<dd>An output node receives a message containing a system utterance
as a string in <code class="docutils literal"><span class="pre">msg.payload</span></code>. This utterance is what the system
wants to say to the user, and the output node sends this string out to
the appropriate output channel.</dd>
<dt>enter</dt>
<dd>An enter node acts as an entry point to a specific part of the conversation.
Each entry node contains a set of <em>entrance conditions</em>, which must all
be satisfied in order for the conversation to proceed according to the
content linked from the entry node. Entry nodes receive messages exclusively
from the router, which chooses what entry nodes to send messages to.
Once an entry node receives a message, it sends the message out through
its output wire.</dd>
<dt>state</dt>
<dd>State nodes define what the agent does, says, and how the conversational
context is updated. Context is kept as user variables that can be accessed
in messages. System output, or agent utterances, are also set in state nodes.
State nodes can contain arbitrary JavaScript code to manipulate the context
and messages in general.</dd>
<dt>NLU</dt>
<dd>Having a Natural Language Understanding (NLU) node is crucial to allow a
conversational agent deal with the unbounded variety of natural language input.
NLU nodes essentially map natural language input utterances into a set
of symbols that can be manipulated by the rest of the conversational flow.</dd>
</dl>
</div>
</div>
<div class="section" id="router">
<h2>Router<a class="headerlink" href="#router" title="Permalink to this headline">¶</a></h2>
<p>The router node is of central importance in ChatFlow, since it is responsible
for choosing what system actions to perform in each conversational turn.
The choices presented to the router are the enter nodes available. The router
will only consider enter nodes with entrance conditions that are satisfied at
that point in the conversation. Of these viable enter nodes, the router will
choose one based on the following criteria:</p>
<ol class="arabic simple">
<li>An enter node marked as an initial state will be chosen when the router receives its first message in the current conversation. More than one node may be marked as an initial state, and these will be ranked according the rest of the criteria.</li>
<li>Enter nodes that satisfy an explicit ordering preference will be chosen if possible. See the section on enter nodes below for more on specific ordering constraints for enter nodes.</li>
<li>Enter nodes with entrance conditions based on <code class="docutils literal"><span class="pre">msg.NLU</span></code> have priority over enter nodes, to ensure that the system is responsive to user input.</li>
<li>Enter nodes with precise conditions (i.e. checking for equality) are preferred over nodes with other conditions (e.g. greater than, is not null, regex matching). When multiple entrance conditions are present, nodes with a greater number of precise conditions (equality) are preferred.</li>
</ol>
<p>Once a router receives a message, it selects an enter node. If none are
eligible, the router sends out a message via output wire. If an enter node
receives a message from the router, it will pass that message through its own
output wire. If the message reaches a <strong>state</strong> node with <em>no output wires</em>,
the state node sends its message back to the router. In other words, <strong>enter</strong>
nodes and <strong>state</strong> nodes are the entry and exit points that the router has
to and from the author-defined conversational content. This conversational
content consists of enter nodes, state nodes, and any other nodes
available. For example, it may include a Yelp node, which is a wrapper to the
Yelp developer API, as in the example provided later in this documentation.</p>
<div class="admonition-nlu-results-are-only-available-to-the-first-enter-node-chosen-by-the-router-in-each-conversational-turn admonition">
<p class="first admonition-title">NLU results are only available to the first enter node chosen by the router in each conversational turn</p>
<p class="last">In each conversational turn, the system may use several enter nodes to build a system response.
Once the router receives user input and the corresponding labeling from an NLU node, the router
will prefer to choose an enter containing one or more entrance conditions involving <code class="docutils literal"><span class="pre">msg.NLU</span></code>,
with the goal of being responsive to user input. Only the first enter node chosen by the router has
access to the NLU results in <code class="docutils literal"><span class="pre">msg.NLU</span></code>,  whether or not it contained a <code class="docutils literal"><span class="pre">msg.NLU</span></code> entrance condition.
The enter node will pass its message with the <code class="docutils literal"><span class="pre">NLU</span></code> property to subsequent nodes connected to it
by wires, but once the message is sent back to the router by a state node, the <code class="docutils literal"><span class="pre">NLU</span></code> property will
be deleted. This ensures that the router will not keep responding to the same NLU event multiple
times. Of course, the intent and entities in the NLU results can be saved explicitly in user
variables (e.g.  <code class="docutils literal"><span class="pre">msg.kitt.destination</span> <span class="pre">=</span> <span class="pre">msg.NLU.entities.destination</span></code>, or
<code class="docutils literal"><span class="pre">msg.kitt.current_intent</span> <span class="pre">=</span> <span class="pre">msg.NLU.intent</span></code>, see the NLU section below for details about the
structure of the <code class="docutils literal"><span class="pre">NLU</span></code> property in <code class="docutils literal"><span class="pre">msg</span></code>) while the <code class="docutils literal"><span class="pre">NLU</span></code> property is still in the message.</p>
</div>
</div>
<div class="section" id="enter-nodes">
<h2>Enter Nodes<a class="headerlink" href="#enter-nodes" title="Permalink to this headline">¶</a></h2>
<p>Enter nodes are the router&#8217;s entry point into conversational content, which is typically a collection of networks, each bookended by an enter node (the entry point) and a state node (the exit point for the network). In between the enter node and the state node, there may be other state nodes and other Node-RED nodes, such as function nodes. All of the inter-node communication that happens between the enter node, which receives messages from the router, and the last state node, which sends messages back to the router, happen through wires, following Node-RED&#8217;s usual message flow.</p>
<div class="section" id="ordering-preferences">
<h3>Ordering preferences<a class="headerlink" href="#ordering-preferences" title="Permalink to this headline">¶</a></h3>
<p>Note, however, that the output of a state node can be wired to the input of an enter node, but once that connection is made, the resulting connection is not a wire in the Node-RED sense, and is shown on the screen as a dashed line, unlike wires that are shown as solid lines. This dashed line does not represent a wire over which messages can be sent, and rather an <em>ordering preference</em>, which says that the enter node should be preferred by the router immediately after the router receives a message from the state node. In other words, a sequence of state node and enter node (in that order), connected by a dashed line, does not mean that the state node has an outgoing wire, and it does not mean that the enter node has an incoming wire. That state node will still send its message to the router, and the enter node will still get its message from the router. The dashed line simply means that once that state node is executed and sends its message to the router, the router will choose the enter node, provided that the enter node&#8217;s entrance conditions are satisfied.</p>
<p>An example of a dashed line representing an ordering preference for an enter node following a state node is shown in the image below.</p>
<a class="reference internal image-reference" href="images/enternode-orderingpref.png"><img alt="Ordering preference for an enter node following a state node" class="align-right" src="images/enternode-orderingpref.png" style="height: 100px;" /></a>
<p>In this example, the router will choose one of the enter nodes <em>U: accept</em> or <em>U: reject</em> immediately after receiving a message from state node <em>confirm choice</em>. For example, if the entrance conditions of the enter node <em>U: accept</em> are met, it will be chosen by the router, even if another node with identical entrance conditions exist, and even if another node with more precise entrance conditions that are satisfied exists.</p>
</div>
<div class="section" id="direct-link">
<h3>Direct link<a class="headerlink" href="#direct-link" title="Permalink to this headline">¶</a></h3>
<p>Each enter node includes a checkbox that says <em>Enter only from direct link</em>. The <em>direct link</em> in this case is the ordering preference described above. If that box is checked for an enter node, that enter node will only be chosen by the router immediately following the state node where the dashed line (ordering preference) originates. It will never be used otherwise. This is useful for state nodes that only make sense in a specific context.</p>
</div>
</div>
<div class="section" id="state-nodes">
<h2>State Nodes<a class="headerlink" href="#state-nodes" title="Permalink to this headline">¶</a></h2>
<p>State nodes update the conversational context and define the actions of the agent, including what it says to the user. Each state node includes a code editor where arbitrary JavaScript code can be added. This code will run any time the state node receives a message. The entire message object can be accessed within the state node through the object <code class="docutils literal"><span class="pre">msg</span></code>.
.. in a similar way to how <a href="#id2"><span class="problematic" id="id3">`function nodes in Node-RED&lt;http://nodered.org/docs/writing-functions.html&gt;`_</span></a> work.
In addition,
.. to functionality similar to Node-RED function nodes
state nodes also include a field where a system utterance can be added. Whenever the state node receives a message, its utterance is added to what the system will say to the user in the current conversational turn.</p>
<p>The two most basic uses of state nodes are:</p>
<ol class="arabic simple">
<li>Adding system utterances to the conversational turn, or, in other words, defining what the system will say.</li>
<li>Updating user variables, which may comprise a substantial portion of the conversational state. In our quickstart example, the variable <code class="docutils literal"><span class="pre">count</span></code> was an user variable defined and updated in state nodes.</li>
</ol>
<p>User variables exist in a property of the message called <code class="docutils literal"><span class="pre">kitt</span></code>. Unlike other properties of the message <code class="docutils literal"><span class="pre">msg</span></code>, all of the user variables in <code class="docutils literal"><span class="pre">kitt</span></code> persist throughout the entire interaction. This is a key difference between user variables and other properties of <code class="docutils literal"><span class="pre">msg</span></code>.  Whenever an enter node receives a message, all of the user variables are available in <code class="docutils literal"><span class="pre">msg.kitt</span></code>, and these variables can be used in entrance conditions.</p>
<div class="section" id="final-state">
<h3>Final state<a class="headerlink" href="#final-state" title="Permalink to this headline">¶</a></h3>
<p>State nodes include a checkbox that says <em>Dialogue ends here</em>. If that box is checked in a specific state node, whenever that state node is executed (i.e. whenever it receives a message and its code runs), the conversation ends, and the state of the router is reset, including deletion of all user variables.</p>
</div>
</div>
<div class="section" id="nlu">
<h2>NLU<a class="headerlink" href="#nlu" title="Permalink to this headline">¶</a></h2>
<p>Natural Language Understanding nodes are designed to map user utterances in natural language into a finite vocabulary of symbols. Two sets of symbols comprise the output of the NLU: <em>intents</em> and <em>entities</em>. Intents are utterance categories that capture the main communicative intent of the input utterance. For example, the intent <em>agreeing</em> captures the communicative intent of many utterances, such as &#8220;I agree&#8221;, &#8220;yes&#8221;, &#8220;of course&#8221;, &#8220;yes, I agree&#8221;, &#8220;I think so too&#8221;, etc. (Of course, each of these utterances may have other intents based on context.) The intent vocabulary (or utterance categories) used by the NLU is defined by the content author, and consists of an arbitrary number of arbitrary strings. These intents can be thought of as buckets in which each incoming input utterance will be placed by the NLU node.</p>
<p>In addition to one <em>intent</em>, each utterance may contain zero or more <em>entities</em>, which are sequences of words in the input utterance that correspond to a category defined by the content author. These categories, like intents, are of arbitrary number and labels. Common examples include <em>locations</em>, <em>names of organizations</em>, <em>prices</em>, etc. Consider, for example, the following utterance: &#8220;Please make me a reservation for six people at Matsuhisa at 7 pm.&#8221; The intent here may be <em>make_restaurant_reservation</em>, and the entities may be <em>party_size</em> (corresponding to the word &#8220;six&#8221;), <em>restaurant_name</em> (corresponding to the word &#8220;Matsuhisa&#8221;) and <em>time</em> (corresponding to &#8220;7 pm&#8221;). Note that these assignments are made in the context of the current utterance. The word &#8220;six&#8221; could be a time in a different utterance (&#8220;I need a reservation at six&#8221;), and it is the job of the NLU to assign the right entities and intents in each utterance.</p>
<p>The internal mechanisms of NLU nodes may vary, but each NLU node must accept input in the form of <code class="docutils literal"><span class="pre">msg.payload</span></code>, and produce output that is placed in its outgoing message in <code class="docutils literal"><span class="pre">msg.NLU</span></code>. The NLU output should contain a property called <code class="docutils literal"><span class="pre">intent</span></code>, which contains a string value corresponding to the input&#8217;s intent, and a property called <code class="docutils literal"><span class="pre">entities</span></code>, which is an object with <code class="docutils literal"><span class="pre">{entity:value}</span></code> pairs, e.g., <code class="docutils literal"><span class="pre">{&quot;restaurant_name&quot;:</span> <span class="pre">&quot;Matsuhisa&quot;,</span> <span class="pre">&quot;party_size&quot;:</span> <span class="pre">&quot;six&quot;,</span> <span class="pre">&quot;time&quot;:</span> <span class="pre">&quot;7</span> <span class="pre">pm&quot;}</span></code>. In cases where multiple occurrences of the same entity type exist in an utterance, the entity value will be a list, e.g. <code class="docutils literal"><span class="pre">{&quot;participant_name&quot;:</span> <span class="pre">[&quot;Sue&quot;,</span> <span class="pre">&quot;Bob&quot;,</span> <span class="pre">&quot;Mary&quot;],</span> <span class="pre">&quot;meeting_location&quot;:</span> <span class="pre">&quot;room</span> <span class="pre">245&quot;}</span></code>.</p>
</div>
<div class="section" id="api-nodes">
<h2>API Nodes<a class="headerlink" href="#api-nodes" title="Permalink to this headline">¶</a></h2>
<p>It is often useful for ChatFlow agents to be able to interact with the external
world. This can be accomplished easily in ChatFlow through the use of nodes
that wrap existing developer APIs for services such as Uber, Yelp, OpenTable,
Fandango, Amazon, etc. The options are almost limitless. ChatFlow includes
a few such nodes pre-built, with more to be added based in part by community
demand. Additionally, abitrary http requrests can be performed using the
<strong>http request</strong> node, so the opportunities to connect with the external
world are endless.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="extended_example.html" class="btn btn-neutral float-right" title="Extended Example: A conversational Yelp bot" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quickstart.html" class="btn btn-neutral" title="ChatFlow Quick Start" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, KITT.AI.
      Last updated on Aug 17, 2016.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>