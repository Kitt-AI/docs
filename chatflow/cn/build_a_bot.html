

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>使用ChatFlow构建第一个bot &mdash; ChatFlow 0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="ChatFlow 0.1 documentation" href="index.html"/>
        <link rel="next" title="Node介绍" href="dialogue_nodes.html"/>
        <link rel="prev" title="快速入门" href="quickstart.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            
              <a href="http://ChatFlow.kitt.ai" target="_blank" class="icon icon-home"> ChatFlow
            
          

          
            
            <img src="_static/ChatFlow-logo.png" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference external" href="../index.html#://">English Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">欢迎使用ChatFlow</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">快速入门</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">使用ChatFlow构建第一个bot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bot">从视频学习构建bot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-free-lunch-bot">The Free Lunch Bot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#app">1. 从头创建一个App</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">2. 会话路由器</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enterstate">3. Enter节点和State节点</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#enter">Enter 节点</a></li>
<li class="toctree-l4"><a class="reference internal" href="#state">State 节点</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id3">4. 增加输入和输出</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#no">用户反馈“No”的情况</a></li>
<li class="toctree-l4"><a class="reference internal" href="#yes">用户反馈 “Yes” 的情况</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">无法处理的情况</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id5">5. NLU和处理自然语言输入</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">添加一个NLU节点</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">创建和NLU应用</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">部署NLU应用</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">配置NLU节点</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id10">6. 重新配置Enter节点</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id11">导入和到导出</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dialogue_nodes.html">Node介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_turn_dialogue.html">多轮对话</a></li>
<li class="toctree-l1"><a class="reference internal" href="superbot.html">Superbot介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">调试 ChatFlow</a></li>
<li class="toctree-l1"><a class="reference internal" href="dueros.html">使用ChatFlow部署小度技能</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ChatFlow</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>使用ChatFlow构建第一个bot</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
        
          <a href="https://groups.google.com/a/kitt.ai/forum/#!forum/chat" class="fa fa-comments" style="color:#55507c" target="_blank"> Forum</a>
        
        
            
            <a href="_sources/build_a_bot.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="chatflowbot">
<span id="build-a-bot"></span><h1><a class="toc-backref" href="#id12">使用ChatFlow构建第一个bot</a><a class="headerlink" href="#chatflowbot" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#chatflowbot" id="id12">使用ChatFlow构建第一个bot</a><ul>
<li><a class="reference internal" href="#id1" id="id13">介绍</a></li>
<li><a class="reference internal" href="#bot" id="id14">从视频学习构建bot</a></li>
<li><a class="reference internal" href="#the-free-lunch-bot" id="id15">The Free Lunch Bot</a><ul>
<li><a class="reference internal" href="#app" id="id16">1. 从头创建一个App</a></li>
<li><a class="reference internal" href="#id2" id="id17">2. 会话路由器</a></li>
<li><a class="reference internal" href="#enterstate" id="id18">3. Enter节点和State节点</a><ul>
<li><a class="reference internal" href="#enter" id="id19">Enter 节点</a></li>
<li><a class="reference internal" href="#state" id="id20">State 节点</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id3" id="id21">4. 增加输入和输出</a><ul>
<li><a class="reference internal" href="#no" id="id22">用户反馈“No”的情况</a></li>
<li><a class="reference internal" href="#yes" id="id23">用户反馈 “Yes” 的情况</a></li>
<li><a class="reference internal" href="#id4" id="id24">无法处理的情况</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5" id="id25">5. NLU和处理自然语言输入</a><ul>
<li><a class="reference internal" href="#id6" id="id26">添加一个NLU节点</a></li>
<li><a class="reference internal" href="#id7" id="id27">创建和NLU应用</a></li>
<li><a class="reference internal" href="#id8" id="id28">部署NLU应用</a></li>
<li><a class="reference internal" href="#id9" id="id29">配置NLU节点</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10" id="id30">6. 重新配置Enter节点</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11" id="id31">导入和到导出</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id13">介绍</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>在这个 <a class="reference external" href="https://ChatFlow.dueros.baidu.com/">ChatFlow</a> 教程中，我们将会演示构建一个bot的全过程。此外，我们会介绍 <a class="reference external" href="https://nlu.kitt.ai/">NLU</a> - ChatFlowde <strong>自然语言理解</strong> 的协作平台。</p>
<dl class="docutils">
<dt>通过学习此教程，你将可以：</dt>
<dd><ul class="first last simple">
<li>从头创建一个新的项目</li>
<li>配置Enter节点和State节点</li>
<li>创建一个 <a class="reference external" href="https://nlu.kitt.ai/">NLU</a> 应用</li>
<li>在 <a class="reference external" href="https://ChatFlow.dueros.baidu.com/">ChatFlow</a> 中配置 NLU 节点</li>
<li>导入、导出 ChatFlow Projects</li>
</ul>
</dd>
</dl>
<p>最终的bot将可以具有如下的功能：</p>
<video width="640"  controls>
  <source src="_static/img/buildabot/BuildABotSample.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
<br> <br> <br></div>
<div class="section" id="bot">
<span id="walkthrough-video"></span><h2><a class="toc-backref" href="#id14">从视频学习构建bot</a><a class="headerlink" href="#bot" title="Permalink to this headline">¶</a></h2>
<p>以下视频将为你完整的演示创建 Free Lunch Bot 的全部过程：</p>
<video width="640"  controls>
  <source src="_static/img/buildabot/BuildABotWalkthrough.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
<br><br><br></div>
<div class="section" id="the-free-lunch-bot">
<h2><a class="toc-backref" href="#id15">The Free Lunch Bot</a><a class="headerlink" href="#the-free-lunch-bot" title="Permalink to this headline">¶</a></h2>
<div class="section" id="app">
<h3><a class="toc-backref" href="#id16">1. 从头创建一个App</a><a class="headerlink" href="#app" title="Permalink to this headline">¶</a></h3>
<p>接下来我们创建一个功能不只是问好的简单流程吧。我们的新版bot可以向用户请求一份免费的午餐，此外，它还可以计算出在获得免费午餐前需要请求多少次。</p>
<ol class="arabic simple">
<li>点击”Create new app”。</li>
</ol>
<img alt="_images/CreateNewApp.png" class="align-center" src="_images/CreateNewApp.png" />
<ol class="arabic simple" start="2">
<li>在 “Start with a clean project” 下面输入项目的名称，并点击“Create”。</li>
</ol>
<img alt="_images/StartFromScratch.png" class="align-center" src="_images/StartFromScratch.png" />
<ol class="arabic simple" start="3">
<li>你的bot将会出现在你的 <strong>应用列表</strong> 中，通过点击项目名称进入 <em>编辑器</em> 。</li>
</ol>
<img alt="_images/AppList.png" class="align-center" src="_images/AppList.png" />
<ol class="arabic simple" start="4">
<li>页面加载后，你将得到一页空白的 <em>画布</em> ，如下图所示。</li>
</ol>
<img alt="_images/BlankCanvas.png" class="align-center" src="_images/BlankCanvas.png" />
<ol class="arabic simple" start="5">
<li>将 <strong>Chat In</strong> 和 <strong>Chat Out</strong> 节点拖入画布。</li>
</ol>
<img alt="_images/chatin-chatout.png" class="align-center" src="_images/chatin-chatout.png" />
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id17">2. 会话路由器</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>将 <strong>Router</strong> 节点拖入空白画布，如下图所示，连接上Chat In, Router, 和 Chat Out 节点。</li>
</ol>
<img alt="_images/router-node.png" class="align-center" src="_images/router-node.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Router用来传递我们的flow中生成的对话消息。</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">为了生效，应用里必须有一个router节点！</p>
</div>
<ol class="arabic simple" start="2">
<li>双击Router节点可以给其命名。</li>
</ol>
<img alt="_images/router-pop-up.png" class="align-center" src="_images/router-pop-up.png" />
</div>
<div class="section" id="enterstate">
<h3><a class="toc-backref" href="#id18">3. Enter节点和State节点</a><a class="headerlink" href="#enterstate" title="Permalink to this headline">¶</a></h3>
<p>除了Router节点，我们还需要 <strong>Enter</strong> 和 <strong>State</strong> 这两个节点。</p>
<p><strong>State</strong> 节点是用来定义bot所说的话。<strong>Enter</strong> 节点上用来制定 <strong>进入条件</strong> （当我们的Flow中有一个分支需要被激活时使用该节点）</p>
<div class="section" id="enter">
<h4><a class="toc-backref" href="#id19">Enter 节点</a><a class="headerlink" href="#enter" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>在画布中增加一个 <strong>Enter</strong> 节点，每个Enter节点包含一系列的 <em>进入条件</em> ，这些 <em>进入条件</em> 可以指定某个特定的Enter节点被路由器选中。</li>
</ol>
<img alt="_images/enternode-1.png" class="align-center" src="_images/enternode-1.png" />
<ol class="arabic simple" start="2">
<li>双击Enter节点可以对其进行编辑。</li>
</ol>
<img alt="_images/enternode-popup.png" class="align-center" src="_images/enternode-popup.png" />
<ol class="arabic simple" start="3">
<li>在这个弹出窗口中，命名该节点。我们先给它命名为 <em>Initial State</em> 。</li>
<li>在命名区域下面是 <strong>进入条件</strong> 区域，通过点击条件右侧的”“X”“，可以删除该条件。</li>
</ol>
<img alt="_images/highlightedx.png" class="align-center" src="_images/highlightedx.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">默认情况是自动添加部分条件来启动该节点。</p>
</div>
<p>5. 选中对话框底部的 <em>Initial state</em> ，将会告诉路由器此Enter节点表示该Flow的第一分支，
你也可以通过在Enter节点上连接 <a class="reference internal" href="#state-node"><span class="std std-ref">State 节点</span></a> 实现变量初始化。</p>
<img alt="_images/initial-state.png" class="align-center" src="_images/initial-state.png" />
</div>
<div class="section" id="state">
<span id="state-node"></span><h4><a class="toc-backref" href="#id20">State 节点</a><a class="headerlink" href="#state" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>在画布上拖入State节点，并放在Enter节点右侧。</li>
<li>连接Enter节点和State节电：点击Enter节点右侧的灰色圆点，然后将生成的线拖住至State节点左侧的灰色圆点上。</li>
</ol>
<img alt="_images/Intialstate-statenode.png" class="align-center" src="_images/Intialstate-statenode.png" />
<ol class="arabic" start="3">
<li><p class="first">双击此State节点，将其命名为 <em>Initialize state</em>。</p>
</li>
<li><p class="first">在命名区域下方，你可以看到 <strong>code editor</strong>，在其中创建一个名为 <code class="docutils literal notranslate"><span class="pre">count</span></code> 的单变量，此变量用于记录我们的bot向用户请求免费午餐的次数。如下所示，为State节点中的代码：</p>
<div class="code javascript highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">return</span> <span class="n">msg</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">用户变量在变量 <code class="docutils literal notranslate"><span class="pre">msg</span></code> 中从一个节点传递到另一个节点。此外， <code class="docutils literal notranslate"><span class="pre">msg.kitt</span></code> 这个特殊属性将会在整个sessions中永久保存，这样你就可以在不同的对话转变中追踪你的上下文。在此例中该变量为 <code class="docutils literal notranslate"><span class="pre">msg.kitt.count</span></code>。</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">与State节点关联的代码应以 <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">msg;</span></code> 结尾，否则将不会输出消息，进而导致对话的终止。</p>
</div>
<ol class="arabic simple" start="5">
<li>勾选 “Request User Input After This Node”，这样bot就可以在进行前等待用户的响应。</li>
<li>在 <em>Output text</em> 区域，输入 <em>“Hello! Will you please buy me lunch?”</em>，这样在State节点被激活时将会输出相应的文字消息，如下图所示。</li>
</ol>
<img alt="_images/initialize-state.png" class="align-center" src="_images/initialize-state.png" />
</div>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id21">4. 增加输入和输出</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>点击Deploy来部署你的bot。</li>
</ol>
<img alt="_images/deploy.png" class="align-center" src="_images/deploy.png" />
<ol class="arabic simple" start="2">
<li>打开 Chat Tab，在屏幕下方的输入区域输入 <em>hello</em> ，接下来你将看到系统根据State节点 <em>Initialize state</em> 自动输出的消息。</li>
</ol>
<img alt="_images/chat-bubble.png" class="align-center" src="_images/chat-bubble.png" />
<div class="section" id="no">
<h4><a class="toc-backref" href="#id22">用户反馈“No”的情况</a><a class="headerlink" href="#no" title="Permalink to this headline">¶</a></h4>
<p>我们接下来让它学会应对用户说 <em>yes</em> 和 <em>no</em> 吧。</p>
<ol class="arabic simple">
<li>增加一个Enter节点和一个State节点，并将这二者连接起来。</li>
<li>编辑Enter节点：</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>命名为 <em>“U: no”</em> ；</li>
<li>设置条件为 <code class="docutils literal notranslate"><span class="pre">Property</span> <span class="pre">msg.payload</span> <span class="pre">==</span> <span class="pre">no</span></code> ；</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">这一步是识别用户从 <em>Chat In</em> 节点输入到路由器的信息是否为 “no” 。</p>
</div>
<img alt="_images/u-no.png" class="align-center" src="_images/u-no.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">一般来说，节点输出的内容被放在 <code class="docutils literal notranslate"><span class="pre">payload</span></code> 中，用户从 <em>Chat In</em> 输入的内容被存储在 <code class="docutils literal notranslate"><span class="pre">msg.payload</span></code> 中。</p>
</div>
<ol class="arabic" start="3">
<li><p class="first">编辑State节点：</p>
<ul class="simple">
<li>命名为 <em>ask again</em> ；</li>
<li>在该节点主体内添加如下代码：</li>
</ul>
<blockquote>
<div><div class="code javascript highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msg</span><span class="o">.</span><span class="n">kitt</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">return</span> <span class="n">msg</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">在 <em>Output text</em> 区域，输入 <em>I must insist. Will you reconsider?</em> ，如下图所示。</p>
</li>
</ol>
<img alt="_images/ask-again.png" class="align-center" src="_images/ask-again.png" />
</div>
<div class="section" id="yes">
<h4><a class="toc-backref" href="#id23">用户反馈 “Yes” 的情况</a><a class="headerlink" href="#yes" title="Permalink to this headline">¶</a></h4>
<p>现在系统已经能理解 <em>no</em> 了，接下来我们再增加一个Enter节点和State节点来处理用户反馈 <em>yes</em> 的情况。</p>
<ol class="arabic simple">
<li>再增加一对Enter节点和State节点，并连接它们。</li>
<li>将Enter节点命名为 <em>U:yes</em> ，并增加如下所示的进入条件：<ul>
<li><code class="docutils literal notranslate"><span class="pre">Property</span> <span class="pre">msg.payload</span> <span class="pre">==</span> <span class="pre">yes</span></code></li>
</ul>
</li>
<li>将State节点命名为 <em>thank user</em>, 并添加代码 <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">msg;</span></code>。</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">在达到这一节点后，我们就不需要bot再做什么了，所以 <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">msg;</span></code> 就是简单将原始消息发送出去。</p>
</div>
<ol class="arabic simple" start="4">
<li>在 <em>Output text</em> 区域，输入 <em>Thank you! Number of times I asked: {{kitt.count}}</em>.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">在 <em>Output text</em> 区域，我们可以获取储存在 <code class="docutils literal notranslate"><span class="pre">msg.kitt</span></code> 中不带 <code class="docutils literal notranslate"><span class="pre">msg</span></code> 前缀的变量。</p>
</div>
<ol class="arabic simple" start="5">
<li>勾选 <em>Dialogue ends here</em> ，该选项是告诉系统一旦到了这个节点，对话就结束了。</li>
</ol>
<img alt="_images/thank-user.png" class="align-center" src="_images/thank-user.png" />
<p>下图显示了整个对话网络：</p>
<img alt="_images/complete-flow-1.png" class="align-center" src="_images/complete-flow-1.png" />
<ol class="arabic simple" start="6">
<li>点击Deploy，然后进入Chat Tab，现在就可以与代理进行如下所示的简单对话了。</li>
</ol>
<img alt="_images/chat-bubble-1.png" class="align-center" src="_images/chat-bubble-1.png" />
</div>
<div class="section" id="id4">
<h4><a class="toc-backref" href="#id24">无法处理的情况</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>我们的bot只能理解 <em>yes</em> 和 <em>no</em>, 因为我们只包含了区分大小写的 <em>yes</em> 和 <em>no</em> 的输入，
如果输入了其他内容，代理将不会有反应。对此，我们可以通过在新建一个Enter节点来处理其他字符串的输入。</p>
<ol class="arabic simple">
<li>在画布中增加一个Enter节点和一个State节点，并将其连接。</li>
<li>编辑Enter节点，将其命名为 “U: default”，然后将其进入条件设置如下：<ul>
<li>Property <code class="docutils literal notranslate"><span class="pre">msg.payload</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">null</span></code></li>
<li>Property <code class="docutils literal notranslate"><span class="pre">msg.NLU.intent</span> <span class="pre">!=</span> <span class="pre">positive_response</span></code></li>
<li>Property <code class="docutils literal notranslate"><span class="pre">msg.NLU.intent</span> <span class="pre">!=</span> <span class="pre">negative_response</span></code></li>
</ul>
</li>
</ol>
<img alt="_images/u-default.png" class="align-center" src="_images/u-default.png" />
<ol class="arabic simple" start="3">
<li>将State节点命名为 <em>not understanding</em> ，添加代码 <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">msg;</span></code>,然后在 <em>Output field</em> 区域输入以下内容：<em>Sorry, I didn’t understand what you said. I only understand “yes” and “no”.</em></li>
</ol>
<img alt="_images/not-understanding.png" class="align-center" src="_images/not-understanding.png" />
<p>现在，你的bot不管是否理解用户输入的内容，都可以有反馈信息了。你的Flow将如下图所示。</p>
<img alt="_images/complete-flow-2.png" class="align-center" src="_images/complete-flow-2.png" />
<p>我们可以与bot做如下的交互：</p>
<img alt="_images/chat-bubble-2.png" class="align-center" src="_images/chat-bubble-2.png" />
</div>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id25">5. NLU和处理自然语言输入</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>我们刚才已经详述了如何在ChatFlow中创造一个具有简易功能的bot，然而我们尚未说明如何让bot理解 <em>自然语言</em> 的语料。
为了不受限制的转换自然语言的语料，我们需要使用 <strong>自然语言理解（NLU）</strong> 节点。 NLU节点可以将语料转换为一组有限的intents和entities，
我们可以将NLU节点作为Enter节点中 <em>进入条件</em> 的基础进行使用。</p>
<div class="section" id="id6">
<h4><a class="toc-backref" href="#id26">添加一个NLU节点</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>在 <em>Chat In</em> 节点和输出的 <em>Router</em> 节点之间插入NLU节点。</li>
</ol>
<img alt="_images/flow-with-NLU.png" class="align-center" src="_images/flow-with-NLU.png" />
</div>
<div class="section" id="id7">
<h4><a class="toc-backref" href="#id27">创建和NLU应用</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple" start="2">
<li>ChatFlow的协作应用里面进入 <a class="reference external" href="https://nlu.kitt.ai/">NLU</a>， 创造一个新的NLU应用，并命名。</li>
<li>在应用里，点击 “Set Up Intents” 来获取下拉菜单。</li>
</ol>
<img alt="_images/setup-intents.png" class="align-center" src="_images/setup-intents.png" />
<ol class="arabic simple" start="4">
<li>点击add intent。</li>
<li>命名new intent为 <code class="docutils literal notranslate"><span class="pre">positive_response</span></code> ，并点击create。</li>
</ol>
<img alt="_images/positive_response.png" class="align-center" src="_images/positive_response.png" />
<ol class="arabic simple" start="6">
<li>在Example of Use下面，增加以下自然语言输入字符串。多增加些也可以。<ul>
<li>Yes</li>
<li>yes</li>
<li>sure</li>
<li>of course</li>
<li>you bet!</li>
<li>it would be my honor</li>
</ul>
</li>
<li>完成后，点击右上方红色的 “X” 关闭窗口。</li>
</ol>
<img alt="_images/positive-utterance.png" class="align-center" src="_images/positive-utterance.png" />
<ol class="arabic" start="8">
<li><p class="first">点击add intent，然后将new intent命名为 <code class="docutils literal notranslate"><span class="pre">negative_response</span></code> ，然后点击create。
在Example of Use下方，增加以下自然语言输入字符串，多增加些也可以。</p>
<blockquote>
<div><ul class="simple">
<li>Nah</li>
<li>no</li>
<li>No way jose!</li>
<li>Never</li>
<li>I shall not</li>
<li>We&nbsp;are not amused</li>
</ul>
</div></blockquote>
</li>
</ol>
<img alt="_images/negative-response.png" class="align-center" src="_images/negative-response.png" />
<ol class="arabic simple" start="9">
<li>完成添加 <code class="docutils literal notranslate"><span class="pre">positive_response</span></code> 和  <code class="docutils literal notranslate"><span class="pre">negative_response</span></code> 这两个intents后，点击 <strong>TRAIN APPLICATION</strong>, 然后点击 <strong>DEPLOY</strong>。</li>
</ol>
<img alt="_images/deploy-nlu.png" class="align-center" src="_images/deploy-nlu.png" />
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">只有进行了train your model和deploy后，你的NLU模型才能进行更新并完整运行。</p>
</div>
<ol class="arabic simple" start="10">
<li>在 <em>“Train the model”</em> 中对你的NLU模型进行测试，输入一句话，然后点击Analyze。</li>
</ol>
<img alt="_images/train-the-model.png" class="align-center" src="_images/train-the-model.png" />
<ol class="arabic simple" start="11">
<li>完成后，查看Analyze的结果。你可以通过点击下图所示的蓝色按钮以及选择正确的反馈来更正结果。完成后，点击submit。</li>
</ol>
<img alt="_images/submit-response.png" class="align-center" src="_images/submit-response.png" />
</div>
<div class="section" id="id8">
<h4><a class="toc-backref" href="#id28">部署NLU应用</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">在最终部署之前，点击 “TRAIN APPLICATION” 来进行整体优化，然后即可发布 RESTful API到你的应用中。</p>
</div>
<ol class="arabic simple" start="12">
<li>点击左上角的 “Show All Apps” 回到NLU应用列表。</li>
<li>在你新创建的应用里面，点击Deployment Information。</li>
</ol>
<img alt="_images/deployment-information.png" class="align-center" src="_images/deployment-information.png" />
<ol class="arabic simple" start="14">
<li>复制 <strong>Deployment Url</strong> 到剪贴板中。</li>
</ol>
<img alt="_images/deployment-url-expanded.png" class="align-center" src="_images/deployment-url-expanded.png" />
</div>
<div class="section" id="id9">
<h4><a class="toc-backref" href="#id29">配置NLU节点</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple" start="15">
<li>编辑NLU节点。在URL区域里粘贴 <strong>Deployment URL</strong> 。</li>
</ol>
<img alt="_images/flow-with-NLU.png" class="align-center" src="_images/flow-with-NLU.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">NLU节点在 <cite>msg.NLU</cite> 中存储了所有的NLU信息，Intents,entities以及原始的语料分别被存储在 <code class="docutils literal notranslate"><span class="pre">msg.NLU.intent</span></code> 中， <code class="docutils literal notranslate"><span class="pre">msg.NLU.entities</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">msg.NLU.sentence</span></code> 。</p>
</div>
<ol class="arabic" start="16">
<li><p class="first">在URL的末尾增加 <code class="docutils literal notranslate"><span class="pre">{{{payload}}}</span></code> ，URL应该如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://api-nlu.kitt.ai/v1/api/900584f4-7360-479c?token=xxx?q={{{payload}}}
</pre></div>
</div>
</li>
</ol>
<img alt="_images/NLU-node-payload.png" class="align-center" src="_images/NLU-node-payload.png" />
</div>
</div>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#id30">6. 重新配置Enter节点</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>我们刚刚为bot配置好了NLU，但仍需重新配置Enter节点 <em>U: Yes</em> 和 <em>U: No</em> ，才能在bot中应用该信息。</p>
<ol class="arabic simple">
<li>编辑 <em>U: Yes</em> 节点：在进入条件框里，移除 <code class="docutils literal notranslate"><span class="pre">Property</span> <span class="pre">msg.payload</span> <span class="pre">==</span> <span class="pre">yes</span></code> 。</li>
<li>添加新条件： <code class="docutils literal notranslate"><span class="pre">Property</span> <span class="pre">msg.NLU.intent</span> <span class="pre">==</span> <span class="pre">positive_response</span></code> 。</li>
</ol>
<img alt="_images/u-yes-2.png" class="align-center" src="_images/u-yes-2.png" />
<ol class="arabic simple" start="3">
<li>编辑 <em>U: No</em> 节点：在进入条件框里，移除 <code class="docutils literal notranslate"><span class="pre">Property</span> <span class="pre">msg.payload</span> <span class="pre">==</span> <span class="pre">no</span></code> 。并添加新条件：<code class="docutils literal notranslate"><span class="pre">Property</span> <span class="pre">msg.NLU.intent</span> <span class="pre">==</span> <span class="pre">negative_response</span></code>.</li>
</ol>
<img alt="_images/u-no-2.png" class="align-center" src="_images/u-no-2.png" />
<ol class="arabic simple" start="4">
<li>完成后，点击Deploy。</li>
</ol>
<p>接下来测试你的bot！ 交互行为应该是如下面视频中所示的这样：</p>
<video width="640"  controls>
  <source src="_static/img/buildabot/BuildABotSample.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
<br> <br> <br></div>
</div>
<div class="section" id="id11">
<h2><a class="toc-backref" href="#id31">导入和到导出</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<p>你可以通过 <strong>Export</strong> 和 <strong>Import JSON</strong> 功能实现 <em>导入</em> 和 <em>导出</em> 项目</p>
<p>导出：点击 <em>ChatFlow Editor</em> 中的 <strong>Export</strong> ，然后选择你所导出的项目是否需要带凭证。ChatFlow可以导出包含完整Flow的JSON文件。</p>
<img alt="_images/export.png" class="align-center" src="_images/export.png" />
<p>导入：点击ChatFlow主页上的 <strong>Import JSON</strong> ，然后选择希望导入的JSON文件。</p>
<img alt="_images/import.png" class="align-center" src="_images/import.png" />
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">ChatFlow和NLU都有导入导出功能。但是ChatFlow应用不能在NLU中导入，同样的，NLU应用也不能在ChatFlow中导入。</p>
</div>
<p>除了可以随意使用bot模版，还可以：</p>
<ul class="simple">
<li>下载我们的应用 <a class="reference download internal" href="_downloads/TheFreeLunchBot.json" download=""><code class="xref download docutils literal notranslate"><span class="pre">ChatFlow</span> <span class="pre">json</span></code></a> ，并使用Import JSON功能导入 <a class="reference external" href="https://ChatFlow.kitt.ai/apps">applications</a> 上的内容。</li>
<li>在主页上点击”CREATE NEW APP”时，可以使用”Free Lunch”样例。</li>
</ul>
<p>此外，可以下载 <a class="reference download internal" href="_downloads/TheFreeLunchBot-nlu.json" download=""><code class="xref download docutils literal notranslate"><span class="pre">NLU</span> <span class="pre">json</span></code></a>
并使用NLU的Import JSON功能导入 <a class="reference external" href="https://nlu.kitt.ai">an NLU application</a> 中的内容，并在ChatFlow应用中进行配置。</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dialogue_nodes.html" class="btn btn-neutral float-right" title="Node介绍" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quickstart.html" class="btn btn-neutral" title="快速入门" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p  style="color:#999;">
        &copy; Copyright 2016, KITT.AI.
      Last updated on Mar 26, 2018.

    </p>
  </div> 

  <div>

    <p>
      Made with <i class="fa fa-heart" style="color:red;"></i> in the city of
      <i class="fa fa-coffee" style="color:#6F4E37;"></i>
      <i class="fa fa-umbrella" style="color:#007FFF;"></i>
      <i class="fa fa-plane" style="color:#0F52BA;"></i>
      <i class="fa fa-diamond" style="color:#50C878;"></i>
    </p>
  </div>

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/js/anchor.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>