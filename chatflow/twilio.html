

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Twilio Bot Tutorials &mdash; ChatFlow 0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" type="text/css" />
  

  
    <link rel="top" title="ChatFlow 0.1 documentation" href="index.html"/>
        <link rel="next" title="Kik Bot Tutorials" href="kik.html"/>
        <link rel="prev" title="Slack Bot Tutorials" href="slack.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            
              <a href="http://chatflow.kitt.ai" target="_blank" class="icon icon-home"> ChatFlow
            
          

          
            
            <img src="_static/chatflow-logo.png" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Welcome to ChatFlow</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">ChatFlow Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_a_bot.html">ChatFlow Build A Bot Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogue_nodes.html">Dialogue Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">Debug ChatFlow</a></li>
<li class="toctree-l1"><a class="reference internal" href="extended_example.html">Extended Example: A Conversational Yelp Bot</a></li>
<li class="toctree-l1"><a class="reference internal" href="telegram.html">Telegram Bot Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="facebook.html">Facebook Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="slack.html">Slack Bot Tutorials</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Twilio Bot Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparing-twilio-account">Preparing Twilio account</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-simple-reverse-bot">A Simple Reverse Bot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#reverse-bot-video-tutorial">Reverse Bot Video Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-new-chatflow-app-with-twilio-nodes">1. Create a New Chatflow App with Twilio Nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-twilio-nodes">2. Configure Twilio Nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-the-function-node">3. Configuring the Function Node</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deploy-the-application">4. Deploy the Application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#basic-debugging">Basic Debugging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#add-debugging-functionality">5. Add Debugging Functionality</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#twilio-in-and-twilio-out-nodes">Twilio In and Twilio Out Nodes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#twilio-in">Twilio In</a></li>
<li class="toctree-l3"><a class="reference internal" href="#twilio-out">Twilio Out</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#an-advanced-twilio-bot-with-session-router-support">An Advanced Twilio Bot with Session/Router Support</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#add-bot-video-tutorial">Add Bot Video Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-add-bot-from-scratch">Creating Add Bot from Scratch</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="kik.html">Kik Bot Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="skype.html">Skype Bot Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="alexa.html">Alexa Skill Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="alexa_advanced.html">Advanced Alexa Skill Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="alexa_nlu.html">Advanced Alexa Skill NLU Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth2.html">OAuth2/Uber Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ChatFlow</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Twilio Bot Tutorials</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          <a href="https://groups.google.com/a/kitt.ai/forum/#!forum/chat" class="fa fa-comments" style="color:#55507c" target="_blank"> Forum</a>
        
        
            
            <a href="_sources/twilio.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="twilio-bot-tutorials">
<span id="twilio"></span><h1><a class="toc-backref" href="#id2">Twilio Bot Tutorials</a><a class="headerlink" href="#twilio-bot-tutorials" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#twilio-bot-tutorials" id="id2">Twilio Bot Tutorials</a><ul>
<li><a class="reference internal" href="#introduction" id="id3">Introduction</a></li>
<li><a class="reference internal" href="#preparing-twilio-account" id="id4">Preparing Twilio account</a></li>
<li><a class="reference internal" href="#a-simple-reverse-bot" id="id5">A Simple Reverse Bot</a><ul>
<li><a class="reference internal" href="#reverse-bot-video-tutorial" id="id6">Reverse Bot Video Tutorial</a></li>
<li><a class="reference internal" href="#create-a-new-chatflow-app-with-twilio-nodes" id="id7">1. Create a New Chatflow App with Twilio Nodes</a></li>
<li><a class="reference internal" href="#configure-twilio-nodes" id="id8">2. Configure Twilio Nodes</a></li>
<li><a class="reference internal" href="#configuring-the-function-node" id="id9">3. Configuring the Function Node</a></li>
<li><a class="reference internal" href="#deploy-the-application" id="id10">4. Deploy the Application</a></li>
</ul>
</li>
<li><a class="reference internal" href="#basic-debugging" id="id11">Basic Debugging</a><ul>
<li><a class="reference internal" href="#add-debugging-functionality" id="id12">5. Add Debugging Functionality</a></li>
</ul>
</li>
<li><a class="reference internal" href="#twilio-in-and-twilio-out-nodes" id="id13">Twilio In and Twilio Out Nodes</a><ul>
<li><a class="reference internal" href="#twilio-in" id="id14">Twilio In</a></li>
<li><a class="reference internal" href="#twilio-out" id="id15">Twilio Out</a></li>
</ul>
</li>
<li><a class="reference internal" href="#an-advanced-twilio-bot-with-session-router-support" id="id16">An Advanced Twilio Bot with Session/Router Support</a><ul>
<li><a class="reference internal" href="#add-bot-video-tutorial" id="id17">Add Bot Video Tutorial</a></li>
<li><a class="reference internal" href="#creating-add-bot-from-scratch" id="id18">Creating Add Bot from Scratch</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id3">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In this <a class="reference external" href="https://chatflow.kitt.ai/">Chatflow</a> tutorial, we&#8217;ll show you how to program a text reversing bot
for Twilio.
The following video shows the bot in action:</p>
<video height="640" style="display:block; margin: 0 auto;" controls>
  <source src="_static/img/twilio/ReverseBot.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
<br> <br> <br><p>In addition, we explain the input and output for the Twilio In and Twilio out
nodes.</p>
<dl class="docutils">
<dt>By the end of this tutorial, you will be able to:</dt>
<dd><ul class="first last simple">
<li>Connect a ChatFlow app to Twilio.</li>
<li>Understand the input and output of the Twilio In and Twilio nodes</li>
<li>Debug a chatflow bot</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="preparing-twilio-account">
<span id="preparing-twilio"></span><h2><a class="toc-backref" href="#id4">Preparing Twilio account</a><a class="headerlink" href="#preparing-twilio-account" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can skip this section if you already have a Twilio account and/or
know how to set it up.</p>
</div>
<ol class="arabic simple">
<li><a class="reference external" href="https://www.twilio.com/try-twilio">Sign up</a> for a Twilio account. Trial
accounts are free. You do not have to provide any payment details.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure you search for phone numbers in/close to your area and with
SMS capabilities enabled.</p>
</div>
<ol class="arabic simple" start="2">
<li>After finishing the registration, you will have to <a class="reference external" href="https://www.twilio.com/console/phone-numbers/search">&#8220;buy&#8221;</a> a phone number.
The first phone number in trial accounts (at time of writing) is free.</li>
</ol>
</div>
<div class="section" id="a-simple-reverse-bot">
<span id="twilio-reverse-bot"></span><h2><a class="toc-backref" href="#id5">A Simple Reverse Bot</a><a class="headerlink" href="#a-simple-reverse-bot" title="Permalink to this headline">¶</a></h2>
<div class="section" id="reverse-bot-video-tutorial">
<h3><a class="toc-backref" href="#id6">Reverse Bot Video Tutorial</a><a class="headerlink" href="#reverse-bot-video-tutorial" title="Permalink to this headline">¶</a></h3>
<iframe width="640" height="360" src="https://www.youtube.com/embed/SL6izsi9Xbk"
    frameborder="0" allowfullscreen></iframe>
 <br><br><br></div>
<div class="section" id="create-a-new-chatflow-app-with-twilio-nodes">
<h3><a class="toc-backref" href="#id7">1. Create a New Chatflow App with Twilio Nodes</a><a class="headerlink" href="#create-a-new-chatflow-app-with-twilio-nodes" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Start by opening the ChatFlow application list and add a new application.
Press the &#8220;Create new App&#8221; button.</li>
</ol>
<img alt="_images/twilio-new-app.png" class="align-center" src="_images/twilio-new-app.png" />
<ol class="arabic simple" start="2">
<li>Enter a name and press &#8220;Create&#8221;.</li>
</ol>
<img alt="_images/twilio-create-app.png" class="align-center" src="_images/twilio-create-app.png" />
<ol class="arabic simple" start="3">
<li>Click on the application name on the list to edit it.</li>
</ol>
<img alt="_images/twilio-edit-app.png" class="align-center" src="_images/twilio-edit-app.png" />
<ol class="arabic" start="4">
<li><dl class="first docutils">
<dt>To make your app nice and tidy, enable grid in the settings/view menu.</dt>
<dd><img alt="_images/twilio-snap-grid.png" class="first last align-center" src="_images/twilio-snap-grid.png" />
</dd>
</dl>
</li>
<li><p class="first">Find <strong>Twilio In</strong> and <strong>Twilio Out</strong> nodes in the Node Library (left side)
and add them to the flow.</p>
</li>
</ol>
<img alt="_images/twilio-palette.png" class="align-center" src="_images/twilio-palette.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If the <strong>Twilio In</strong> and <strong>Twilio Out</strong> nodes are not in your Node
Library, click on Settings in the right hand corner. A drop down will open.
Click on Node Installer:</p>
<img alt="_images/settings_install_node3.png" class="align-center" src="_images/settings_install_node3.png" />
<p>In the Node Installer, search for <strong>Twilio</strong>. Click on the blue arrow to
the right of <strong>Twilio</strong> to add the nodes into your Node Library:</p>
<img alt="_images/install_nodes_pop_up2.png" class="last align-center" src="_images/install_nodes_pop_up2.png" />
</div>
<ol class="arabic simple" start="6">
<li>Find the <strong>function</strong> node in the Node Library and add it to the flow too.</li>
<li>Connect the <strong>Twilio In</strong> node output to the function node input and the
function node output to the &#8220;Twilio Out&#8221; input, so your flow looks like this:</li>
</ol>
<img alt="_images/twilio-added-connected.png" class="align-center" src="_images/twilio-added-connected.png" />
</div>
<div class="section" id="configure-twilio-nodes">
<h3><a class="toc-backref" href="#id8">2. Configure Twilio Nodes</a><a class="headerlink" href="#configure-twilio-nodes" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Double click on the &#8220;Twilio in&#8221; node, and click on the displayed &#8220;Twilio
receiving url&#8221; to copy it to your clipboard (highlighted in yellow).</li>
</ol>
<img alt="_images/twilio-receiving-url.png" class="align-center" src="_images/twilio-receiving-url.png" />
<ol class="arabic simple" start="2">
<li>In the Twilio console, go to your Phone numbers list by clicking on &#8220;Phone
Numbers&#8221; on the right hand side.</li>
</ol>
<img alt="_images/twilio-cp-phone-numbers.png" class="align-center" src="_images/twilio-cp-phone-numbers.png" />
<ol class="arabic simple" start="3">
<li>Edit the settings for the phone number you just bought.</li>
</ol>
<img alt="_images/twilio-cp-phone-list.png" class="align-center" src="_images/twilio-cp-phone-list.png" />
<ol class="arabic simple" start="4">
<li>Paste the address you copied from the &#8220;Twilio in node&#8221; in the &#8220;A message comes
in&#8221; field. Click the &#8220;Save&#8221; button.</li>
</ol>
<img alt="_images/twilio-cp-add-webhook.png" class="align-center" src="_images/twilio-cp-add-webhook.png" />
<ol class="arabic simple" start="5">
<li>Go to the Twilio console dashboard (the main screen) to display your Account
SID and Auth Token.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You have to click the padlock icon to make Auth Token visible (the SID
and token displayed in this tutorial are fake, so don&#8217;t try to use them ;) ).</p>
</div>
<img alt="_images/twilio-cp-credentials.png" class="align-center" src="_images/twilio-cp-credentials.png" />
<ol class="arabic simple" start="6">
<li>In ChatFlow, double click on the &#8220;Twilio Out&#8221; node. Copy Account SID and Auth
Token from Twilio dashboard to this form.</li>
<li>Enable &#8220;Respond mode&#8221; and click &#8220;OK&#8221;.</li>
</ol>
<img alt="_images/twilio-out-credentials.png" class="align-center" src="_images/twilio-out-credentials.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">&#8220;Respond mode&#8221; is a quick way to enable your app to respond to incoming
SMS messages (received by a Twilio In node) without having to write any
extra code. When it&#8217;s enabled and you don&#8217;t redefine <code class="docutils literal"><span class="pre">msg.twilio.from</span></code>/<code class="docutils literal"><span class="pre">to</span></code>
values, then those values are used in reverse, so when you use a Twilio Out
node, the recipient phone number will be read from <code class="docutils literal"><span class="pre">msg.twilio.in</span></code> (and
sender phone number will be read from <code class="docutils literal"><span class="pre">msg.twilio.from</span></code> accordingly). This
feature also allows you to use one &#8220;Twilio Out&#8221; node with multiple
&#8220;Twilio In&#8221; nodes.</p>
</div>
</div>
<div class="section" id="configuring-the-function-node">
<h3><a class="toc-backref" href="#id9">3. Configuring the Function Node</a><a class="headerlink" href="#configuring-the-function-node" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Double click on the function node. Fill it like in the example below:</li>
</ol>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">reverse</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">msg</span><span class="p">;</span>
</pre></div>
</div>
<img alt="_images/twilio-fn-reverse.png" class="align-center" src="_images/twilio-fn-reverse.png" />
</div>
<div class="section" id="deploy-the-application">
<h3><a class="toc-backref" href="#id10">4. Deploy the Application</a><a class="headerlink" href="#deploy-the-application" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Hit the &#8220;Deploy&#8221; button. Now your app is running and you can test it.</li>
</ol>
<img alt="_images/twilio-deploy.png" class="align-center" src="_images/twilio-deploy.png" />
<p>Send a text message (SMS) to the phone number you bought. Your app should
respond in seconds with a message containing the text you sent, but reversed.</p>
</div>
</div>
<div class="section" id="basic-debugging">
<h2><a class="toc-backref" href="#id11">Basic Debugging</a><a class="headerlink" href="#basic-debugging" title="Permalink to this headline">¶</a></h2>
<div class="section" id="add-debugging-functionality">
<h3><a class="toc-backref" href="#id12">5. Add Debugging Functionality</a><a class="headerlink" href="#add-debugging-functionality" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Add a debug node to the flow. Connect it&#8217;s input to the &#8220;Twilio in&#8221; output.</li>
</ol>
<img alt="_images/twilio-debug-added.png" class="align-center" src="_images/twilio-debug-added.png" />
<ol class="arabic simple" start="2">
<li>Double click the debug node you added and set it up to log &#8220;twilio&#8221; property
of &#8220;msg&#8221;.</li>
</ol>
<img alt="_images/twilio-debug-edit.png" class="align-center" src="_images/twilio-debug-edit.png" />
<ol class="arabic simple" start="3">
<li>Activate the debug panel and send another text message. Message details should
be shown in the debug panel. You can read about those details in
<a class="reference external" href="https://www.twilio.com/docs/api/twiml/sms/twilio_request">Twilio documentation</a>.</li>
</ol>
<img alt="_images/twilio-debug-sms.png" class="align-center" src="_images/twilio-debug-sms.png" />
<p>You can download the whole aplication <a class="reference external" href="_static/json/twilio-echo-bot.json">here</a>.
You only have to setup Twilio In/Out nodes manually.</p>
</div>
</div>
<div class="section" id="twilio-in-and-twilio-out-nodes">
<h2><a class="toc-backref" href="#id13">Twilio In and Twilio Out Nodes</a><a class="headerlink" href="#twilio-in-and-twilio-out-nodes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="twilio-in">
<span id="twilio-in-node"></span><h3><a class="toc-backref" href="#id14">Twilio In</a><a class="headerlink" href="#twilio-in" title="Permalink to this headline">¶</a></h3>
<p>The following fields are set in the output message:</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">msg</span> <span class="o">=</span> <span class="p">{</span>
       <span class="nx">twillio</span><span class="o">:</span> <span class="p">{</span>
                   <span class="nx">from</span><span class="o">:</span> <span class="s2">&quot;who.sent.the.message&quot;</span><span class="p">,</span>
                   <span class="nx">to</span><span class="o">:</span> <span class="s2">&quot;who.is.the.message.sent.to&quot;</span><span class="p">,</span>
                   <span class="nx">body</span><span class="o">:</span> <span class="s2">&quot;message.content&quot;</span>
                 <span class="p">}</span>
       <span class="nx">payload</span><span class="o">:</span> <span class="s2">&quot;message.content&quot;</span>
     <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="12%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">twilio.from</span></code></td>
<td>String</td>
<td>Sender phone number in E.164 format</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">twilio.to</span></code></td>
<td>String</td>
<td>Recipient phone number in E.164 format</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">twilio.body</span></code></td>
<td>String</td>
<td>Message Body</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">payload</span></code></td>
<td>String</td>
<td>Message Body (duplicate of <code class="docutils literal"><span class="pre">twilio.body</span></code>)</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The twilio property may contain other sub-properties, see the
<a class="reference external" href="https://www.twilio.com/docs/api/twiml/sms/twilio_request">Twilio documentation</a>
for details (property names are always &#8220;camelCased&#8221; in this node output).</p>
</div>
</div>
<div class="section" id="twilio-out">
<span id="twilio-out-node"></span><h3><a class="toc-backref" href="#id15">Twilio Out</a><a class="headerlink" href="#twilio-out" title="Permalink to this headline">¶</a></h3>
<p>The following is an acceptable input for Twilio Out:</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">msg</span> <span class="o">=</span> <span class="p">{</span>
       <span class="nx">twillio</span><span class="o">:</span> <span class="p">{</span>
                   <span class="nx">from</span><span class="o">:</span> <span class="s2">&quot;who.sent.the.message&quot;</span><span class="p">,</span>
                   <span class="nx">to</span><span class="o">:</span> <span class="s2">&quot;who.is.the.message.sent.to&quot;</span>
                 <span class="p">}</span>
       <span class="nx">payload</span><span class="o">:</span> <span class="s2">&quot;message.content&quot;</span>
     <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="8%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">twilio.from</span></code></td>
<td>String</td>
<td>Sender phone number. Must be in E.164 format or an Alphanumeric Sender ID</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">twilio.to</span></code></td>
<td>String</td>
<td>Recipient phone number. Must be in E.164 format</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">payload</span></code></td>
<td>String</td>
<td>Message Body</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Notice: longer messages (especially containing &#8220;high&#8221; unicode characters)
may be sent in multiple parts, part arrival order is not guaranteed by Twilio.</p>
</div>
</div>
</div>
<div class="section" id="an-advanced-twilio-bot-with-session-router-support">
<span id="advanced-twilio-bot"></span><h2><a class="toc-backref" href="#id16">An Advanced Twilio Bot with Session/Router Support</a><a class="headerlink" href="#an-advanced-twilio-bot-with-session-router-support" title="Permalink to this headline">¶</a></h2>
<div class="section" id="add-bot-video-tutorial">
<h3><a class="toc-backref" href="#id17">Add Bot Video Tutorial</a><a class="headerlink" href="#add-bot-video-tutorial" title="Permalink to this headline">¶</a></h3>
<iframe width="640" height="360" src="https://www.youtube.com/embed/qMnErJlZNLw" frameborder="0" allowfullscreen></iframe>
<br><br><br></div>
<div class="section" id="creating-add-bot-from-scratch">
<h3><a class="toc-backref" href="#id18">Creating Add Bot from Scratch</a><a class="headerlink" href="#creating-add-bot-from-scratch" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Create a new app and add the following nodes:</li>
</ol>
<ul class="simple">
<li>Twilio In</li>
<li>Twilio Out</li>
<li>router</li>
<li>3x enter</li>
<li>3x state</li>
<li>1x function</li>
</ul>
<ol class="arabic simple" start="2">
<li>Connect added nodes so the flow looks like this:</li>
</ol>
<img alt="_images/twilio2-adv-connected.png" class="align-center" src="_images/twilio2-adv-connected.png" />
<ol class="arabic simple" start="3">
<li>Set up Twilio In/Out nodes (the previous tutorial shows how to do it).</li>
<li>Edit the first &#8220;enter&#8221; node, name it &#8220;start&#8221;, set it as the initial state and
remove the condition:</li>
</ol>
<img alt="_images/twilio2-initial.png" class="align-center" src="_images/twilio2-initial.png" />
<p>You can leave the first state node unchanged.</p>
<ol class="arabic simple" start="5">
<li>Edit the second &#8220;enter&#8221; node, name it &#8220;add counter&#8221;, and set it up to accept
<code class="docutils literal"><span class="pre">add</span></code> in the payload property.</li>
</ol>
<img alt="_images/twilio2-add-counter.png" class="align-center" src="_images/twilio2-add-counter.png" />
<ol class="arabic simple" start="6">
<li>Edit the function node connected to the &#8220;add counter&#8221; node, name it &#8220;increase
counter&#8221; and add the following code to the function body</li>
</ol>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">counter</span> <span class="o">=</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">counter</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<img alt="_images/twilio2-inc-counter.png" class="align-center" src="_images/twilio2-inc-counter.png" />
<ol class="arabic simple" start="7">
<li>Edit the second state node (the one connected to the function node you just
edited), name it &#8220;print counter&#8221; and replace the commented out code with the
following code:</li>
</ol>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">_responses</span> <span class="o">=</span> <span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">kitt</span><span class="p">.</span><span class="nx">counter</span><span class="p">];</span>
</pre></div>
</div>
<img alt="_images/twilio2-print-counter.png" class="align-center" src="_images/twilio2-print-counter.png" />
<ol class="arabic simple" start="8">
<li>Edit the third enter node, name it &#8220;end&#8221;, and set it up to accept <code class="docutils literal"><span class="pre">bye</span></code> in
the payload property.</li>
</ol>
<img alt="_images/twilio2-state-end.png" class="align-center" src="_images/twilio2-state-end.png" />
<ol class="arabic simple" start="9">
<li>Edit the third state node, name it &#8220;bye&#8221;, set &#8220;Output text&#8221; to <code class="docutils literal"><span class="pre">Bye</span> <span class="pre">bye.</span></code>,
leave the code as is. Make sure you check the &#8220;Dialogue ends here&#8221; option.</li>
</ol>
<img alt="_images/twilio2-state-bye.png" class="align-center" src="_images/twilio2-state-bye.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The &#8220;Twilio In&#8221; node sets up session variables automatically, so you
don&#8217;t have to edit the router node. However, as messages from Twilio have no
direct support for &#8220;sessions&#8221;, so you may want to tune the &#8220;idle&#8221; session
length manually.</p>
</div>
<p>Now you can deploy the application. The finshed flow should look like this:</p>
<img alt="_images/twilio2-finished.png" class="align-center" src="_images/twilio2-finished.png" />
<p>Now by sending &#8220;add&#8221; message to your Twilio phone number you increase the counter
(each user has own counter). By sending &#8220;bye&#8221; message, you end the conversation
(and reset/kill the counter).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can download the whole sample aplication
<a class="reference external" href="_static/json/twilio-router-bot.json">from here</a>. You will only have to setup
Twilio In/Out nodes manually.</p>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="kik.html" class="btn btn-neutral float-right" title="Kik Bot Tutorials" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="slack.html" class="btn btn-neutral" title="Slack Bot Tutorials" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p  style="color:#999;">
        &copy; Copyright 2016, KITT.AI.
      Last updated on Nov 14, 2016.

    </p>
  </div> 

  <div>

    <p>
      Made with <i class="fa fa-heart" style="color:red;"></i> in the city of
      <i class="fa fa-coffee" style="color:#6F4E37;"></i>
      <i class="fa fa-umbrella" style="color:#007FFF;"></i>
      <i class="fa fa-plane" style="color:#0F52BA;"></i>
      <i class="fa fa-diamond" style="color:#50C878;"></i>
    </p>
  </div>

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/js/anchor.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>